import{e as B,i as E,M as J,k as R,A as O,r as V,x as K,B as H,m as S,o as N,n as e,w as s,a as h,b as a,C as T,d as g,t as _,_ as P,K as G,l as Q,L as d}from"./BvexhTZs.js";import I from"./B2MUHF3Z.js";import{_ as X}from"./DJZ-4X_g.js";import{_ as Y}from"./DLtCItMV.js";import{_ as Z}from"./DlpFS5KH.js";import{_ as ee}from"./Te087XyE.js";import{a as U,b as z,_ as j}from"./CX0wwNc8.js";import{_ as A}from"./QhSbJoSr.js";import{M as te}from"./D6QIHz9A.js";import{_ as oe}from"./BmVW1-Kl.js";import{u as ne,D as ae}from"./BQKrPI31.js";import{D as le}from"./Br9_p3OE.js";import"./D10rQJ_b.js";import"./DlAUqK2U.js";import"./DNxf501w.js";import"./CNS46M7W.js";import"./DkygctF7.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./CUw6zPDB.js";import"./k0-rRQS5.js";import"./CjRf5-Eg.js";import"./CHIgUVhi.js";import"./Baq5sz8T.js";import"./DW7TBzO-.js";import"./DUVp9UZ0.js";import"./CLsMh9cr.js";import"./BqQ6eC6R.js";import"./CIcvgKWt.js";import"./BaE5Zpvg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";const se={class:"space-y-4"},ie={class:"max-h-[60vh] overflow-auto rounded-md border"},ce={class:"flex justify-end gap-2"},re=B({__name:"form-item",props:{show:{type:Boolean},policy:{}},emits:["update:show","saved"],setup(M,{emit:o}){const{t:i}=E(),{$api:b}=J(),x=R(),r=M,f=o,l=O({name:"",content:""}),c=O({name:"",content:""}),y=V(!1),$=K({get:()=>r.show,set:p=>f("update:show",p)}),v=()=>{l.name=r.policy?.name??"",typeof r.policy?.content=="object"?l.content=JSON.stringify(r.policy.content,null,2):l.content=r.policy?.content?String(r.policy.content):"",u()},u=()=>{c.name="",c.content=""};H(()=>r.policy,()=>{v()},{immediate:!0});const w=()=>{f("update:show",!1),y.value=!1,v()},k=()=>{if(u(),l.name.trim()||(c.name=i("Please enter policy name")),!l.content.trim())c.content=i("Please enter policy content");else try{JSON.parse(l.content)}catch{c.content=i("Policy format invalid")}return!c.name&&!c.content},C=async()=>{if(!k()){x.error(i("Please fill in the correct format"));return}y.value=!0;try{const p=JSON.parse(l.content);await b.put(`/add-canned-policy?name=${encodeURIComponent(l.name.trim())}`,p),x.success(i("Saved")),w(),f("saved")}catch(p){console.error(p),x.error(i("Save Failed"))}finally{y.value=!1}};return(p,m)=>{const t=Z;return N(),S(te,{modelValue:$.value,"onUpdate:modelValue":m[3]||(m[3]=n=>$.value=n),title:e(i)("Policy Original"),size:"lg","close-on-backdrop":!1},{footer:s(()=>[h("div",ce,[a(e(P),{variant:"outline",onClick:m[2]||(m[2]=n=>w())},{default:s(()=>[g(_(e(i)("Cancel")),1)]),_:1}),a(e(P),{variant:"default",loading:y.value,onClick:C},{default:s(()=>[g(_(e(i)("Submit")),1)]),_:1},8,["loading"])])]),default:s(()=>[h("div",se,[a(e(j),null,{default:s(()=>[a(e(U),{for:"policy-name"},{default:s(()=>[g(_(e(i)("Policy Name")),1)]),_:1}),a(e(z),null,{default:s(()=>[a(e(ee),{id:"policy-name",modelValue:l.name,"onUpdate:modelValue":m[0]||(m[0]=n=>l.name=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),c.name?(N(),S(e(A),{key:0,class:"text-destructive"},{default:s(()=>[g(_(c.name),1)]),_:1})):T("",!0)]),_:1}),a(e(j),null,{default:s(()=>[a(e(U),{for:"policy-content"},{default:s(()=>[g(_(e(i)("Policy Original")),1)]),_:1}),a(e(z),null,{default:s(()=>[h("div",ie,[a(t,{id:"policy-content",modelValue:l.content,"onUpdate:modelValue":m[1]||(m[1]=n=>l.content=n)},null,8,["modelValue"])])]),_:1}),c.content?(N(),S(e(A),{key:0,class:"text-destructive"},{default:s(()=>[g(_(c.content),1)]),_:1})):T("",!0)]),_:1})])]),_:1},8,["modelValue","title"])}}}),me=Object.assign(re,{__name:"PoliciesFormItem"}),pe={class:"text-2xl font-bold"},ue={class:"space-y-3"},He=B({__name:"index",setup(M){const{t:o}=E(),{$api:i}=J(),b=R(),x=G(),r=V([]),f=V(!1),l=V(""),c=t=>{u.value={...t}},y=t=>{x.error({title:o("Warning"),content:o("Are you sure you want to delete this policy?"),positiveText:o("Confirm"),negativeText:o("Cancel"),onPositiveClick:()=>m(t)})},$=[{accessorKey:"name",header:()=>o("Name"),cell:({row:t})=>d("span",{class:"font-medium"},t.original.name),filterFn:"includesString"},{id:"actions",header:()=>o("Actions"),enableSorting:!1,enableHiding:!1,meta:{width:200},cell:({row:t})=>d("div",{class:"flex items-center gap-2"},[d(P,{variant:"outline",size:"sm",onClick:()=>c(t.original)},()=>[d(I,{name:"ri:edit-2-line",class:"size-4"}),d("span",o("Edit"))]),d(P,{variant:"outline",size:"sm",onClick:()=>y(t.original)},()=>[d(I,{name:"ri:delete-bin-5-line",class:"size-4"}),d("span",o("Delete"))])])}],{table:v}=ne({data:r,columns:$,getRowId:t=>t.name});H(l,t=>{v.getColumn("name")?.setFilterValue(t||void 0)});const u=V(null),w=K({get:()=>!!u.value,set:t=>{t||(u.value=null)}}),k=()=>{u.value={name:"",content:"{}"}},C=async()=>{f.value=!0;try{const t=await i.get("/list-canned-policies");r.value=Object.keys(t).sort((n,D)=>n.localeCompare(D)).map(n=>({name:n,content:t[n]}))}catch(t){console.error(t),b.error(o("Failed to fetch data"))}finally{f.value=!1}},p=()=>C();async function m(t){try{await i.delete(`/remove-canned-policy?name=${encodeURIComponent(t.name)}`),b.success(o("Delete Success")),await C()}catch(n){console.error(n),b.error(o("Delete Failed"))}}return Q(C),(t,n)=>{const D=X,L=Y,W=me,q=oe;return N(),S(q,null,{default:s(()=>[a(L,null,{actions:s(()=>[a(D,{modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=F=>l.value=F),placeholder:e(o)("Search"),clearable:"",class:"max-w-sm"},null,8,["modelValue","placeholder"]),a(e(P),{variant:"outline",onClick:k},{default:s(()=>[a(e(I),{name:"ri:add-line",class:"size-4"}),h("span",null,_(e(o)("New Policy")),1)]),_:1})]),default:s(()=>[h("h1",pe,_(e(o)("IAM Policies")),1)]),_:1}),h("div",ue,[a(ae,{table:e(v),"is-loading":f.value,"empty-title":e(o)("No Policies"),"empty-description":e(o)("Create a policy to manage access control templates.")},null,8,["table","is-loading","empty-title","empty-description"]),a(le,{table:e(v),class:"px-2 py-3"},null,8,["table"])]),a(W,{show:w.value,"onUpdate:show":n[1]||(n[1]=F=>w.value=F),policy:u.value,onSaved:p},null,8,["show","policy"])]),_:1})}}});export{He as default};
