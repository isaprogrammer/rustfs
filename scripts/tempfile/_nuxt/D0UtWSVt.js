import{_ as le}from"./BX464hKy.js";import M from"./B2MUHF3Z.js";import{e as ee,i as te,k as ae,x as k,r as p,B as J,m as se,o as C,w as o,a as V,b as t,c as B,C as Q,n as e,d as y,t as m,I as ne,F as W,y as X,_ as U,K as re,h as ue,L as b}from"./BvexhTZs.js";import{_ as ie}from"./DJZ-4X_g.js";import{_ as ce}from"./DLtCItMV.js";import{_ as me}from"./BmVW1-Kl.js";import{_ as de,a as pe}from"./BlQnixsQ.js";import{_ as Z}from"./Te087XyE.js";import{_ as I,a as z,b as E}from"./CX0wwNc8.js";import{_ as H}from"./zIRx1Luc.js";import{M as fe}from"./D6QIHz9A.js";import{u as oe}from"./DirN9_Lc.js";import{_ as _e}from"./BXOynmZH.js";import{u as ve,D as be}from"./BQKrPI31.js";import{n as ge}from"./BzVVdaTJ.js";import{d as ye}from"./CqtTy1rW.js";import{u as ke}from"./Bl8vUFjY.js";import{u as Ce}from"./BDEBxj3U.js";import{u as Ve}from"./CtlZ1-xA.js";import"./D10rQJ_b.js";import"./DlAUqK2U.js";import"./CLsMh9cr.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./DW7TBzO-.js";import"./CjRf5-Eg.js";import"./CNS46M7W.js";import"./DNxf501w.js";import"./DkygctF7.js";import"./DlpFS5KH.js";import"./C06YvAAS.js";import"./Bp33T8J9.js";import"./BqQ6eC6R.js";import"./CIcvgKWt.js";import"./k0-rRQS5.js";import"./BaE5Zpvg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";import"./CHIgUVhi.js";import"./DZMOwJ3K.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./Baq5sz8T.js";const we={class:"space-y-6"},he={key:0,class:"space-y-4 rounded-lg border p-4"},xe={key:0,class:"space-y-4"},Ne={class:"text-sm font-medium"},Be={class:"flex flex-col gap-2 sm:flex-row"},De={class:"text-sm font-medium"},je={class:"flex justify-end gap-2"},Oe=ee({__name:"new-form",props:{show:{type:Boolean}},emits:["update:show"],setup(q,{emit:D}){const A=q,r=D,{t:u}=te(),L=ae(),{createBucket:P,putBucketVersioning:K,putObjectLockConfiguration:T}=oe({}),j=k({get:()=>A.show,set:s=>r("update:show",s)}),v=p(""),g=p(!1),d=p(!1),f=p(!1),O=p("COMPLIANCE"),R=p("180"),w=p("day"),h=p(!1);J(d,s=>{s?g.value=!0:f.value=!1}),J(g,s=>{!s&&d.value&&(d.value=!1)});const x=k(()=>v.value.trim()),Y=k(()=>x.value.length?x.value.length<3||x.value.length>63:!1),$=k(()=>{const s=x.value.length;return h.value||s<3||s>63}),G=k(()=>[{label:u("COMPLIANCE"),value:"COMPLIANCE"},{label:u("GOVERNANCE"),value:"GOVERNANCE"}]),a=k(()=>[{label:u("Day"),value:"day"},{label:u("Year"),value:"year"}]),c=k(()=>{const s=Number.parseInt(R.value,10);return Number.isFinite(s)&&s>0?s:1}),_=()=>{v.value="",g.value=!1,d.value=!1,f.value=!1,O.value="COMPLIANCE",R.value="180",w.value="day"},S=()=>{r("update:show",!1),_()},i=async()=>{if($.value)return;const s=x.value;h.value=!0;try{await P({Bucket:s,ObjectLockEnabledForBucket:d.value});const l=async()=>{d.value&&f.value&&await T(s,{ObjectLockEnabled:"Enabled",Rule:{DefaultRetention:{Mode:O.value,Days:w.value==="day"?c.value:void 0,Years:w.value==="year"?c.value:void 0}}})};g.value&&await K(s,"Enabled");try{await l()}catch{L.error(u("Retention Save Failed"))}L.success(u("Create Success")),S()}catch(l){L.error(l?.message||u("Create Failed"))}finally{h.value=!1}};return(s,l)=>{const N=pe,F=de;return C(),se(fe,{modelValue:j.value,"onUpdate:modelValue":l[7]||(l[7]=n=>j.value=n),title:e(u)("Create Bucket"),size:"lg","close-on-backdrop":!1},{footer:o(()=>[V("div",je,[t(e(U),{variant:"outline",onClick:S},{default:o(()=>[y(m(e(u)("Cancel")),1)]),_:1}),t(e(U),{variant:"default",loading:h.value,disabled:$.value,onClick:i},{default:o(()=>[y(m(e(u)("Create")),1)]),_:1},8,["loading","disabled"])])]),default:o(()=>[V("div",we,[t(e(I),null,{default:o(()=>[t(e(z),{for:"bucket-name"},{default:o(()=>[y(m(e(u)("Please enter name")),1)]),_:1}),t(e(E),null,{default:o(()=>[t(e(Z),{id:"bucket-name",modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=n=>v.value=n),autocomplete:"off",class:ne(["w-full",Y.value&&"border-destructive focus-visible:ring-destructive"])},null,8,["modelValue","class"])]),_:1})]),_:1}),t(e(I),{orientation:"responsive",class:"items-center"},{default:o(()=>[t(e(z),null,{default:o(()=>[y(m(e(u)("Version")),1)]),_:1}),t(e(E),{class:"flex justify-end"},{default:o(()=>[t(e(H),{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=n=>g.value=n)},null,8,["modelValue"])]),_:1})]),_:1}),t(e(I),{orientation:"responsive",class:"items-center"},{default:o(()=>[t(e(z),null,{default:o(()=>[y(m(e(u)("Object Lock")),1)]),_:1}),t(e(E),{class:"flex justify-end"},{default:o(()=>[t(e(H),{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=n=>d.value=n)},null,8,["modelValue"])]),_:1})]),_:1}),d.value?(C(),B("div",he,[t(e(I),{orientation:"responsive",class:"items-center"},{default:o(()=>[t(e(z),null,{default:o(()=>[y(m(e(u)("Retention")),1)]),_:1}),t(e(E),{class:"flex justify-end"},{default:o(()=>[t(e(H),{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=n=>f.value=n)},null,8,["modelValue"])]),_:1})]),_:1}),f.value?(C(),B("div",xe,[t(e(I),null,{default:o(()=>[t(e(z),null,{default:o(()=>[y(m(e(u)("Retention Mode")),1)]),_:1}),t(e(E),null,{default:o(()=>[t(F,{modelValue:O.value,"onUpdate:modelValue":l[4]||(l[4]=n=>O.value=n),class:"grid gap-2 sm:grid-cols-2"},{default:o(()=>[(C(!0),B(W,null,X(G.value,n=>(C(),B("label",{key:n.value,class:"flex items-start gap-3 rounded-md border border-border/50 p-3"},[t(N,{value:n.value,class:"mt-0.5"},null,8,["value"]),V("span",Ne,m(n.label),1)]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(e(I),null,{default:o(()=>[t(e(z),null,{default:o(()=>[y(m(e(u)("Validity")),1)]),_:1}),t(e(E),null,{default:o(()=>[V("div",Be,[t(e(Z),{modelValue:R.value,"onUpdate:modelValue":l[5]||(l[5]=n=>R.value=n),type:"number",class:"sm:w-32"},null,8,["modelValue"]),t(F,{modelValue:w.value,"onUpdate:modelValue":l[6]||(l[6]=n=>w.value=n),class:"grid gap-2 sm:grid-cols-2"},{default:o(()=>[(C(!0),B(W,null,X(a.value,n=>(C(),B("label",{key:n.value,class:"flex items-start gap-3 rounded-md border border-border/50 p-3"},[t(N,{value:n.value,class:"mt-0.5"},null,8,["value"]),V("span",De,m(n.label),1)]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1})])):Q("",!0)])):Q("",!0)])]),_:1},8,["modelValue","title"])}}}),Re=Object.assign(Oe,{__name:"BucketsNewForm"}),Se={class:"text-2xl font-bold"},Vt=ee({__name:"index",async setup(q){let D,A;const{t:r}=te(),u=ae(),L=re(),{listBuckets:P,deleteBucket:K}=oe({}),T=ke(),j=p(!1),v=p(""),{data:g,pending:d,refresh:f}=([D,A]=ue(async()=>Ce("buckets",async()=>{const a=await P(),_=(await T.getDataUsageInfo())?.buckets_usage??{};return(a.Buckets??[]).map(i=>{const s=i?.Name;if(!s)return null;const l=_[s],N=typeof l?.objects_count=="number"?l.objects_count:0,F=typeof l?.size=="number"?l.size:0;return{Name:s,CreationDate:i?.CreationDate?new Date(i.CreationDate).toISOString():"",Count:N,Size:ge(String(F))}}).filter(i=>i!==null).sort((i,s)=>i.Name.localeCompare(s.Name))},{default:()=>[]})),D=await D,A(),D),O=k(()=>{const a=g.value??[];if(!v.value)return a;const c=v.value.toLowerCase();return a.filter(_=>_.Name.toLowerCase().includes(c))}),R=[{header:()=>r("Bucket"),accessorKey:"Name",cell:({row:a})=>b(le,{href:`/browser/${encodeURIComponent(a.original.Name)}`,class:"flex items-center gap-2 text-primary hover:underline"},()=>[b(M,{name:"ri:archive-line",class:"size-4"}),a.original.Name])},{header:()=>r("Creation Date"),accessorKey:"CreationDate",cell:({row:a})=>ye(a.original.CreationDate).format("YYYY-MM-DD HH:mm:ss")},{header:()=>r("Object Count"),accessorKey:"Count",cell:({row:a})=>a.original.Count?.toLocaleString()??"0"},{header:()=>r("Size"),accessorKey:"Size"},{id:"actions",header:()=>r("Actions"),enableSorting:!1,meta:{width:200},cell:({row:a})=>b("div",{class:"flex items-center gap-2"},[b(U,{variant:"outline",size:"sm",onClick:()=>Y(a.original.Name)},()=>[b(M,{name:"ri:settings-5-line",class:"size-4"}),b("span",r("Settings"))]),b(U,{variant:"outline",size:"sm",onClick:()=>$(a.original)},()=>[b(M,{name:"ri:delete-bin-5-line",class:"size-4"}),b("span",r("Delete"))])])}],{table:w}=ve({data:O,columns:R,manualPagination:!0,getRowId:a=>a.Name}),h=p(),x=a=>{j.value=a,a||f()},Y=a=>{h.value?.openDrawer(a)},$=a=>{L.error({title:r("Warning"),content:r("Are you sure you want to delete this bucket?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>G(a)})},G=async a=>{const _=await Ve({bucket:a.Name}).listObject(a.Name,void 0,1);if(!!_?.Contents?.some(i=>!!i?.Key)||!!_?.CommonPrefixes?.length){u.error(r("Bucket is not empty"));return}try{await K(a.Name),u.success(r("Delete Success")),await f()}catch(i){u.error(i?.response?.data?.message||r("Delete Failed"))}};return(a,c)=>{const _=ie,S=ce,i=me,s=Re,l=_e;return C(),B(W,null,[t(i,null,{default:o(()=>[t(S,null,{actions:o(()=>[t(_,{modelValue:v.value,"onUpdate:modelValue":c[0]||(c[0]=N=>v.value=N),placeholder:e(r)("Search"),clearable:"",class:"max-w-sm"},null,8,["modelValue","placeholder"]),t(e(U),{variant:"outline",onClick:c[1]||(c[1]=N=>j.value=!0)},{default:o(()=>[t(e(M),{name:"ri:add-line",class:"size-4"}),V("span",null,m(e(r)("Create Bucket")),1)]),_:1}),t(e(U),{variant:"outline",onClick:c[2]||(c[2]=()=>e(f)())},{default:o(()=>[t(e(M),{name:"ri:refresh-line",class:"size-4"}),V("span",null,m(e(r)("Refresh")),1)]),_:1})]),default:o(()=>[V("h1",Se,m(e(r)("Buckets")),1)]),_:1}),t(be,{table:e(w),"is-loading":e(d),"empty-title":e(r)("No Buckets"),"empty-description":e(r)("Create a bucket to start storing objects.")},null,8,["table","is-loading","empty-title","empty-description"])]),_:1}),t(s,{show:j.value,"onUpdate:show":x},null,8,["show"]),t(l,{ref_key:"infoRef",ref:h},null,512)],64)}}});export{Vt as default};
