import{a$ as M,b0 as _,b1 as I,b2 as V,aG as C,aH as y,aI as O,aJ as f,aK as w,b3 as N,b4 as G,b5 as $,b6 as U,b7 as q,b8 as F,b9 as W,ba as Z,bb as Y,bc as J,bd as Q,be as X,bf as ee,bg as te,bh as se,bi as ne,bj as ae,bk as re,bl as ie,bm as oe,bn as ce,bo as de,bp as le,bq as me,br as ue,bs as ge,bt as pe,bu as be,bv as he,bw as Ce,bx as ye,M as Oe,by as v}from"./BvexhTZs.js";import{g as x,P as fe,G as we}from"./DirN9_Lc.js";const je="content-length",Pe="x-amz-decoded-content-length";function Se(){return(s,t)=>async n=>{const{request:e}=n;if(M.isInstance(e)&&!(je in e.headers)&&!(Pe in e.headers)){const r="Are you using a Stream of unknown length as the Body of a PutObject request? Consider using Upload instead from @aws-sdk/lib-storage.";typeof t?.logger?.warn=="function"&&!(t.logger instanceof _)?t.logger.warn(r):console.warn(r)}return s({...n})}}const ke={step:"finalizeRequest",tags:["CHECK_CONTENT_LENGTH_HEADER"],name:"getCheckContentLengthHeaderPlugin",override:!0},Ee=s=>({applyToStack:t=>{t.add(Se(),ke)}}),xe=s=>(t,n)=>async e=>{const r=await t(e),{response:d}=r;if(I.isInstance(d)&&d.headers.expires){d.headers.expiresstring=d.headers.expires;try{V(d.headers.expires)}catch(c){n.logger?.warn(`AWS SDK Warning for ${n.clientName}::${n.commandName} response parsing (${d.headers.expires}): ${c}`),delete d.headers.expires}}return r},Be={tags:["S3"],name:"s3ExpiresMiddleware",override:!0,relation:"after",toMiddleware:"deserializerMiddleware"},K=s=>({applyToStack:t=>{t.addRelativeTo(xe(),Be)}});function ze(s){return t=>async n=>{const e={...n.input},r=[{target:"SSECustomerKey",hash:"SSECustomerKeyMD5"},{target:"CopySourceSSECustomerKey",hash:"CopySourceSSECustomerKeyMD5"}];for(const d of r){const c=e[d.target];if(c){let m;typeof c=="string"?Le(c,s)?m=s.base64Decoder(c):(m=s.utf8Decoder(c),e[d.target]=s.base64Encoder(m)):(m=ArrayBuffer.isView(c)?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c),e[d.target]=s.base64Encoder(m));const u=new s.md5;u.update(m),e[d.hash]=s.base64Encoder(await u.digest())}}return t({...n,input:e})}}const De={name:"ssecMiddleware",step:"initialize",tags:["SSE"],override:!0},D=s=>({applyToStack:t=>{t.add(ze(s),De)}});function Le(s,t){if(!/^(?:[A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(s))return!1;try{return t.base64Decoder(s).length===32}catch{return!1}}class Re extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","DeleteObject",{}).n("S3Client","DeleteObjectCommand").f(void 0,void 0).ser(N).de(G).build(){}class ve extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","DeleteObjectTagging",{}).n("S3Client","DeleteObjectTaggingCommand").f(void 0,void 0).ser($).de(U).build(){}class Ae extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),x(e,{requestChecksumRequired:!1,requestValidationModeMember:"ChecksumMode",responseAlgorithms:["CRC64NVME","CRC32","CRC32C","SHA256","SHA1"]}),D(e),K()]}).s("AmazonS3","GetObject",{}).n("S3Client","GetObjectCommand").f(q,F).ser(W).de(Z).build(){}class He extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","GetObjectLegalHold",{}).n("S3Client","GetObjectLegalHoldCommand").f(void 0,void 0).ser(Y).de(J).build(){}class Me extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","GetObjectTagging",{}).n("S3Client","GetObjectTaggingCommand").f(void 0,void 0).ser(Q).de(X).build(){}class Ke extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e),D(e),K()]}).s("AmazonS3","HeadObject",{}).n("S3Client","HeadObjectCommand").f(ee,te).ser(se).de(ne).build(){}class A extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Prefix:{type:"contextParams",name:"Prefix"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","ListObjectsV2",{}).n("S3Client","ListObjectsV2Command").f(void 0,void 0).ser(ae).de(re).build(){}class Te extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Prefix:{type:"contextParams",name:"Prefix"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),w(e)]}).s("AmazonS3","ListObjectVersions",{}).n("S3Client","ListObjectVersionsCommand").f(void 0,void 0).ser(ie).de(oe).build(){}class _e extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),x(e,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!1}),Ee(),w(e),D(e)]}).s("AmazonS3","PutObject",{}).n("S3Client","PutObjectCommand").f(ce,de).ser(le).de(me).build(){}class Ie extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),x(e,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!0}),w(e)]}).s("AmazonS3","PutObjectLegalHold",{}).n("S3Client","PutObjectLegalHoldCommand").f(void 0,void 0).ser(ue).de(ge).build(){}class Ve extends C.classBuilder().ep({...y,Bucket:{type:"contextParams",name:"Bucket"}}).m(function(t,n,e,r){return[O(e,this.serialize,this.deserialize),f(e,t.getEndpointParameterInstructions()),x(e,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!0}),w(e)]}).s("AmazonS3","PutObjectTagging",{}).n("S3Client","PutObjectTaggingCommand").f(void 0,void 0).ser(pe).de(be).build(){}function Ne(s){const{port:t,query:n}=s;let{protocol:e,path:r,hostname:d}=s;e&&e.slice(-1)!==":"&&(e+=":"),t&&(d+=`:${t}`),r&&r.charAt(0)!=="/"&&(r=`/${r}`);let c=n?he(n):"";c&&c[0]!=="?"&&(c=`?${c}`);let m="";if(s.username!=null||s.password!=null){const P=s.username??"",S=s.password??"";m=`${P}:${S}@`}let u="";return s.fragment&&(u=`#${s.fragment}`),`${e}//${m}${d}${r}${c}${u}`}const Ge="UNSIGNED-PAYLOAD",$e="X-Amz-Content-Sha256";class H{signer;constructor(t){const n={service:t.signingName||t.service||"s3",uriEscapePath:t.uriEscapePath||!1,applyChecksum:t.applyChecksum||!1,...t};this.signer=new Ce(n)}presign(t,{unsignableHeaders:n=new Set,hoistableHeaders:e=new Set,unhoistableHeaders:r=new Set,...d}={}){return this.prepareRequest(t,{unsignableHeaders:n,unhoistableHeaders:r,hoistableHeaders:e}),this.signer.presign(t,{expiresIn:900,unsignableHeaders:n,unhoistableHeaders:r,...d})}presignWithCredentials(t,n,{unsignableHeaders:e=new Set,hoistableHeaders:r=new Set,unhoistableHeaders:d=new Set,...c}={}){return this.prepareRequest(t,{unsignableHeaders:e,unhoistableHeaders:d,hoistableHeaders:r}),this.signer.presignWithCredentials(t,n,{expiresIn:900,unsignableHeaders:e,unhoistableHeaders:d,...c})}prepareRequest(t,{unsignableHeaders:n=new Set,unhoistableHeaders:e=new Set,hoistableHeaders:r=new Set}={}){n.add("content-type"),Object.keys(t.headers).map(u=>u.toLowerCase()).filter(u=>u.startsWith("x-amz-server-side-encryption")).forEach(u=>{r.has(u)||e.add(u)}),t.headers[$e]=Ge;const d=t.headers.host,c=t.port,m=`${t.hostname}${t.port!=null?":"+c:""}`;(!d||d===t.hostname&&t.port!=null)&&(t.headers.host=m)}}const Ue=async(s,t,n={})=>{let e,r;if(typeof s.config.endpointProvider=="function"){const b=(await ye(t.input,t.constructor,s.config)).properties?.authSchemes?.[0];b?.name==="sigv4a"?r=b?.signingRegionSet?.join(","):r=b?.signingRegion,e=new H({...s.config,signingName:b?.signingName,region:async()=>r})}else e=new H(s.config);const d=(B,b)=>async z=>{const{request:j}=z;if(!M.isInstance(j))throw new Error("Request to be presigned is not an valid HTTP request.");delete j.headers["amz-sdk-invocation-id"],delete j.headers["amz-sdk-request"],delete j.headers["x-amz-user-agent"];let k;const E={...n,signingRegion:n.signingRegion??b.signing_region??r,signingService:n.signingService??b.signing_service};return b.s3ExpressIdentity?k=await e.presignWithCredentials(j,b.s3ExpressIdentity,E):k=await e.presign(j,E),{response:{},output:{$metadata:{httpStatusCode:200},presigned:k}}},c="presignInterceptMiddleware",m=s.middlewareStack.clone();m.addRelativeTo(d,{name:c,relation:"before",toMiddleware:"awsAuthMiddleware",override:!0});const u=t.resolveMiddleware(m,s.config,{}),{output:P}=await u({input:t.input}),{presigned:S}=P;return Ne(S)};function We({bucket:s,region:t}){const n=Oe().$s3Client,e=async i=>{const a={Bucket:s,Key:i};return await n.send(new Ke(a))},r=async(i,a=3600)=>{const o=new Ae({Bucket:s,Key:i});return await Ue(n,o,{expiresIn:a})},d=async(i,a)=>{const o={Bucket:s,Key:i,Body:a};return await n.send(new _e(o))},c=async(i,a)=>{const o={Bucket:s,Key:i};return a&&(o.VersionId=a),await n.send(new Re(o))},m=async(i,a=void 0,o=25)=>{const l={Bucket:i,Prefix:a,MaxKeys:o,Delimiter:"/"};return await n.send(new A(l))};async function u(i,a,o){let l=!0,p;for(;l;){const h={Bucket:i,Prefix:a,ContinuationToken:p};try{const g=await n.send(new A(h));g.Contents?.forEach(R=>{R.Key&&o(R.Key)}),l=g.IsTruncated||!1,p=g.NextContinuationToken}catch(g){throw console.error("Error listing files: ",g),g}}}async function P(i){const[a,o]=await Promise.all([e(i),r(i)]);return{...a,Key:i,SignedUrl:o}}async function S(i){const a={Bucket:s,Key:i};return((await n.send(new Me(a))).TagSet??[]).map(l=>({Key:l.Key??"",Value:l.Value??""}))}async function B(i,a){const o=a.filter(p=>p.Key&&p.Value).map(p=>({Key:p.Key,Value:p.Value})),l={Bucket:s,Key:i,Tagging:{TagSet:o}};return await n.send(new Ve(l))}async function b(i){const a={Bucket:s,Key:i};return await n.send(new ve(a))}async function z(i){const a={Bucket:s,Key:i};try{const l=(await n.send(new we(a)))?.Retention;return!l||Object.keys(l).length===0?{Mode:"",RetainUntilDate:""}:{Mode:l.Mode??"",RetainUntilDate:l.RetainUntilDate?new Date(l.RetainUntilDate).toISOString():""}}catch(o){if(o.message?.includes("Deserialization error"))return{Mode:"",RetainUntilDate:""};throw o}}async function j(i,a){const o={Bucket:s,Key:i,Retention:{Mode:a.Mode==="COMPLIANCE"?v.COMPLIANCE:v.GOVERNANCE,...a.RetainUntilDate?{RetainUntilDate:new Date(a.RetainUntilDate)}:{}}};return await n.send(new fe(o))}async function k(i){const a={Bucket:s,Key:i};return await n.send(new He(a))}async function E(i,a){const o={Bucket:s,Key:i,LegalHold:a};return await n.send(new Ie(o))}async function L(i){const a={Bucket:s,Prefix:i,Delimiter:"/"},o=await n.send(new Te(a)),l=(o.Versions??[]).filter(h=>h.Key===i),p=(o.DeleteMarkers??[]).filter(h=>h.Key===i);return l.sort((h,g)=>+new Date(g.LastModified)-+new Date(h.LastModified)),p.sort((h,g)=>+new Date(g.LastModified)-+new Date(h.LastModified)),{...o,Versions:l,DeleteMarkers:p}}async function T(i){try{const a=await L(i),o=a.Versions||[],l=a.DeleteMarkers||[],p=o.map(g=>c(i,g.VersionId)),h=l.map(g=>c(i,g.VersionId));return await Promise.all([...p,...h]),{success:!0}}catch(a){throw console.error("Error deleting all versions:",a),a}}return{headObject:e,putObject:d,deleteObject:c,getSignedUrl:r,getObjectInfo:P,mapAllFiles:u,listObject:m,getObjectTags:S,putObjectTags:B,deleteObjectTags:b,getObjectRetention:z,putObjectRetention:j,getObjectLegalHold:k,putObjectLegalHold:E,setLegalHold:(i,a)=>E(i,{Status:a?"ON":"OFF"}),listObjectVersions:L,deleteAllVersions:T}}export{Re as D,Ae as G,Ke as H,A as L,_e as P,Ue as a,ve as b,He as c,Me as d,Te as e,Ie as f,D as g,Ve as h,We as u};
