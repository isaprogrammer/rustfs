import{_ as Et}from"./DLtCItMV.js";import Vt from"./B2MUHF3Z.js";import{_ as At,a as Tt}from"./BlQnixsQ.js";import{_ as Rt}from"./DJZ-4X_g.js";import{M as Nt}from"./D6QIHz9A.js";import{_ as It}from"./BmVW1-Kl.js";import{e as Ft,i as Bt,k as $t,r as y,x as R,A as Se,B as Ut,l as zt,m as E,o as c,w as r,b as l,a as n,t as s,n as e,C as m,d as u,_ as v,c as _,F as j,p as jt,y as ne}from"./BvexhTZs.js";import{_ as D}from"./Te087XyE.js";import{E as Pt}from"./CzQd9PUz.js";import{_ as N}from"./C-3P3SYp.js";import{_ as re,a as ie}from"./57wGRvWu.js";import{_ as de,a as Ke,b as ue}from"./Ckea6FOO.js";import{_ as k,a as x,b}from"./CX0wwNc8.js";import{_ as K}from"./QhSbJoSr.js";import{_ as Lt}from"./CjRf5-Eg.js";import{_ as Ot}from"./zIRx1Luc.js";import{S as ce}from"./BqQ6eC6R.js";import{u as qt}from"./DZMOwJ3K.js";import{u as Gt}from"./DirN9_Lc.js";import{_ as Ht}from"./DlAUqK2U.js";import"./CLsMh9cr.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./DW7TBzO-.js";import"./CNS46M7W.js";import"./D10rQJ_b.js";import"./DNxf501w.js";import"./DkygctF7.js";import"./CIcvgKWt.js";import"./k0-rRQS5.js";import"./BaE5Zpvg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";import"./CHIgUVhi.js";const Jt={class:"text-2xl font-bold"},Qt={class:"text-gray-600 dark:text-gray-400"},Wt={class:"space-y-8"},Yt={class:"flex flex-wrap items-center gap-3"},Xt={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3"},Zt={class:"rounded-md border bg-muted/40 p-3"},es={class:"text-xs text-muted-foreground"},ts={class:"text-sm font-medium text-foreground"},ss={class:"rounded-md border bg-muted/40 p-3"},as={class:"text-xs text-muted-foreground"},ls={class:"text-sm font-medium text-foreground"},os={class:"rounded-md border bg-muted/40 p-3"},ns={class:"text-xs text-muted-foreground"},rs={class:"text-sm font-medium text-foreground"},is={class:"flex flex-wrap items-center justify-end gap-2"},ds={class:"space-y-1"},us={key:0,class:"flex gap-2"},cs={key:0,class:"space-y-4"},_s={key:0,class:"rounded-lg border bg-muted/30 p-4 dark:bg-muted/10"},fs={class:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between"},ms={class:"space-y-2"},ps={class:"text-sm font-semibold text-foreground"},ys={class:"space-y-2 text-sm text-muted-foreground"},vs={key:0,class:"italic"},gs={key:1},hs={key:0},ks={key:1},xs={key:2},bs={key:3},Ss={key:0},Ks={key:1},Cs={key:2},ws={key:3},Ds={key:4},Ms={key:5},Es={key:6},Vs={key:7},As={class:"italic"},Ts={key:8},Rs={key:1,class:"flex flex-col items-center justify-center gap-3 rounded-lg border border-dashed py-8 text-muted-foreground"},Ns={class:"text-sm"},Is={class:"text-sm font-medium text-foreground"},Fs={class:"text-xs text-muted-foreground"},Bs={class:"flex flex-col gap-1"},$s={class:"text-sm font-medium"},Us={key:0,class:"text-xs text-muted-foreground"},zs={key:1,class:"grid gap-4 md:grid-cols-2"},js={class:"grid gap-6 md:grid-cols-2"},Ps={class:"flex items-center justify-between rounded-md border p-3"},Ls={class:"flex justify-end gap-2"},Os={class:"space-y-1"},qs={class:"flex flex-wrap gap-2"},Gs={class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},Hs={class:"font-medium text-blue-900 dark:text-blue-100 mb-3"},Js={class:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"},Qs={class:"space-y-2"},Ws={class:"flex items-center space-x-2"},Ys={class:"font-medium text-purple-700 dark:text-purple-300"},Xs={class:"text-gray-600 dark:text-gray-400 ml-5"},Zs={class:"space-y-2"},ea={class:"flex items-center space-x-2"},ta={class:"font-medium text-green-700 dark:text-green-300"},sa={class:"text-gray-600 dark:text-gray-400 ml-5"},aa={class:"space-y-4"},la={class:"flex flex-wrap items-center gap-3"},oa={class:"text-lg font-medium"},na={key:0,class:"space-y-3"},ra={class:"flex justify-between items-start"},ia={class:"flex-1"},da={class:"flex items-center space-x-2 mb-2"},ua={class:"text-sm font-medium text-purple-700 dark:text-purple-300"},ca={class:"font-medium"},_a={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},fa={key:0},ma={key:1},pa={key:2},ya={class:"flex flex-wrap gap-2"},va={key:0,class:"space-y-4 mt-8"},ga={class:"flex items-center space-x-3"},ha={class:"text-lg font-medium"},ka={class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded p-3 text-sm"},xa={class:"text-green-700 dark:text-green-300"},ba={class:"space-y-3"},Sa={class:"flex justify-between items-start"},Ka={class:"flex-1"},Ca={class:"flex items-center space-x-2 mb-2"},wa={class:"text-sm font-medium text-green-700 dark:text-green-300"},Da={class:"font-medium"},Ma={class:"text-sm text-gray-600 dark:text-gray-400 space-y-1"},Ea={key:0},Va={key:1},Aa={key:2},Ta={key:3},Ra={class:"flex flex-wrap gap-2"},Na={class:"flex items-center justify-between gap-3"},Ia={class:"text-lg font-semibold"},Fa={class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},Ba={key:0,class:"space-y-3"},$a={class:"flex items-center justify-between"},Ua={class:"flex-1"},za={class:"flex items-center space-x-3"},ja={class:"text-lg font-medium"},Pa={class:"text-sm text-gray-500"},La={class:"flex items-center space-x-4"},Oa={class:"text-center"},qa={class:"mb-1 text-sm text-gray-500"},Ga={class:"flex flex-wrap gap-2"},Ha={key:0,class:"mt-3 rounded border border-green-200 bg-green-50 p-3 dark:border-green-800 dark:bg-green-900/20"},Ja={class:"text-sm"},Qa={key:0},Wa={key:1,class:"py-8 text-center text-gray-500"},Ya={class:"text-sm"},Xa={key:2,class:"py-8 text-center text-gray-500"},Za={class:"text-sm"},el={key:3,class:"py-8 text-center"},tl={class:"mt-2 text-gray-500"},sl={class:"space-y-4"},al={key:0,class:"text-xs text-muted-foreground"},ll={class:"flex justify-end gap-2"},ol={class:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground"},nl={class:"text-lg font-medium text-foreground"},rl={key:0,class:"text-blue-600 font-medium"},il={class:"flex justify-end gap-2"},dl={class:"space-y-4"},ul={class:"flex justify-end gap-2"},cl={class:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground"},_l={class:"text-lg font-medium text-foreground"},fl={key:0,class:"text-blue-600 font-medium"},ml={class:"flex justify-end gap-2"},pl={class:"flex flex-col items-center gap-2 py-4 text-center text-muted-foreground"},yl={class:"text-lg font-medium text-foreground"},vl={key:0,class:"text-blue-600 font-medium"},gl={class:"text-red-600 font-semibold"},hl={class:"flex justify-end gap-2"},kl={key:0,class:"space-y-6"},xl={class:"grid gap-4 sm:grid-cols-2"},bl={class:"space-y-1"},Sl={class:"text-xs font-semibold uppercase text-muted-foreground"},Kl={class:"text-sm text-foreground"},Cl={class:"space-y-1"},wl={class:"text-xs font-semibold uppercase text-muted-foreground"},Dl={class:"text-sm text-foreground"},Ml={class:"space-y-1"},El={class:"text-xs font-semibold uppercase text-muted-foreground"},Vl={class:"space-y-1"},Al={class:"text-xs font-semibold uppercase text-muted-foreground"},Tl={class:"text-sm text-foreground"},Rl={key:0,class:"space-y-3"},Nl={class:"text-sm font-semibold text-foreground"},Il={class:"grid gap-3 sm:grid-cols-2"},Fl={class:"rounded-lg border p-3"},Bl={class:"text-xs uppercase text-muted-foreground"},$l={class:"text-lg font-semibold text-foreground"},Ul={class:"rounded-lg border p-3"},zl={class:"text-xs uppercase text-muted-foreground"},jl={class:"text-lg font-semibold text-foreground"},Pl={class:"rounded-lg border p-3"},Ll={class:"text-xs uppercase text-muted-foreground"},Ol={class:"text-lg font-semibold text-foreground"},ql={class:"rounded-lg border p-3"},Gl={class:"text-xs uppercase text-muted-foreground"},Hl={class:"text-lg font-semibold text-foreground"},Jl={key:1,class:"py-6 text-center text-muted-foreground"},Ql={class:"flex justify-end"},Wl=Ft({__name:"index",setup(Yl){const{getKMSStatus:Fe,configureKMS:Be,startKMS:$e,stopKMS:Ue,createKey:ze,getKeyList:je,deleteKey:Pe,forceDeleteKey:Le,clearCache:Oe,getDetailedStatus:qe,getKeyDetails:Ge}=qt(),{listBuckets:He,getBucketEncryption:Je,putBucketEncryption:Qe,deleteBucketEncryption:We}=Gt({}),{t}=Bt(),f=$t(),A=y(!1),_e=y(!1);y(!1);const fe=y(!1),me=y(!1),Y=y(!1),pe=y(!1),ye=y(!1),h=y(null),Ce=o=>{switch(o){case"success":return"secondary";case"danger":return"destructive";case"warning":return"outline";case"info":return"secondary";default:return"outline"}},we=R(()=>Ce(lt())),F=y(!1),P=y(!1),L=y(!1),ve=y(!1),ge=y(!1),X=y(!1),he=y(!1),O=y(null),q=y(null),Ye=y({}),Z=y([]),B=y(!1),ee=y(""),te=y("name"),G=y(!1),H=y(!1),ke=y(!1),xe=y(!1),M=y(null),De=y(!1),se=o=>typeof o=="object"&&o!==null&&"Error"in o,a=Se({backend_type:"vault",address:"",auth_type:"token",vault_token:"",vault_app_role_id:"",vault_app_role_secret_id:"",mount_path:"transit",kv_mount:"secret",key_path_prefix:"rustfs/kms/keys",timeout_seconds:30,retry_attempts:3,default_key_id:"rustfs-master",enable_cache:!0,cache_ttl_seconds:600,key_directory:"",has_master_key:!1,file_permissions:void 0,kms_status:"",kms_backend:null,kms_healthy:!1}),w=y([]),C=Se({keyName:"",algorithm:"AES-256"}),S=Se({encryptionType:"",kmsKeyId:""}),Xe=R(()=>[{label:t("Name"),value:"name"},{label:t("Creation Date"),value:"creationDate"}]),Ze=R(()=>[{label:"SSE-S3",value:"SSE-S3"},{label:"SSE-KMS",value:"SSE-KMS"}]),et=[{label:"AES-256",value:"AES-256"},{label:"AES-128",value:"AES-128"},{label:"RSA-2048",value:"RSA-2048"},{label:"RSA-4096",value:"RSA-4096"}],I=R(()=>a.backend_type&&(a.kms_status&&a.kms_status!=="NotConfigured"||a.address||a.default_key_id)),tt=R(()=>[{label:t("Token"),value:"token",description:t("Use Vault token for authentication")},{label:t("AppRole"),value:"approle",description:t("Use AppRole authentication")}]),Me=R(()=>I.value&&a.kms_status==="Running"&&a.kms_healthy),be=R(()=>{let o=[...Z.value];if(ee.value){const i=ee.value.toLowerCase();o=o.filter(p=>p.name.toLowerCase().includes(i))}return o.sort((i,p)=>te.value==="name"?i.name.localeCompare(p.name):te.value==="creationDate"?new Date(p.creationDate).getTime()-new Date(i.creationDate).getTime():0),o}),st=R(()=>at().map(o=>({label:J(o),value:o.key_id}))),at=()=>w.value.filter(o=>!o.key_type||o.key_type==="master"||o.key_type==="CMK"),J=o=>{if(o.description)return o.description;const i=o.tags?.name||o.metadata?.name;if(i)return i;const p=Ye.value[o.key_id];return p||(o.key_id?`Key-${o.key_id.substring(0,8)}`:"Unnamed Key")},lt=()=>{if(!I.value)return"default";if(se(a.kms_status))return"danger";switch(a.kms_status){case"Running":return a.kms_healthy?"success":"warning";case"Configured":return"info";case"Stopped":return"warning";case"Error":return"danger";case"NotConfigured":return"default";default:return"default"}},Ee=()=>{if(!I.value)return t("Not Configured");if(se(a.kms_status))return t("Error");switch(a.kms_status){case"Running":return a.kms_healthy?t("Running"):t("Running (Unhealthy)");case"Configured":return t("Configured");case"NotConfigured":return t("Not Configured");default:return t("Unknown")}},ot=()=>{if(!I.value)return t("KMS server is not configured");if(se(a.kms_status))return t("KMS server has errors")+": "+a.kms_status.Error;switch(a.kms_status){case"Running":return a.kms_healthy&&(!a.address||a.address==="configured-but-hidden")?t("KMS server is running, configuration details are private"):a.kms_healthy?t("KMS server is running and healthy"):t("KMS server is running but unhealthy");case"Configured":return t("KMS server is configured but not running");case"NotConfigured":return t("KMS server is not configured");default:return t("KMS server status unknown")}},$=o=>{const i=o.key_state||o.status;switch(i){case"Enabled":return"Active";case"Disabled":return"Disabled";case"PendingDeletion":return"PendingDeletion";case"Unavailable":return"Inactive";default:return i}},nt=o=>{switch($(o)){case"Active":return"success";case"Inactive":return"default";case"PendingDeletion":return"warning";case"Disabled":return"default";default:return"default"}},Ve=o=>Ce(nt(o)),Ae=o=>{const i=$(o);switch(i){case"Active":return t("Active");case"Inactive":return t("Inactive");case"PendingDeletion":return t("Pending Deletion");case"Disabled":return t("Disabled");default:return i}},Te=o=>({vault:t("HashiCorp Vault Transit Engine")})[o]||o,Re=async o=>{try{const i=await Ge(o);f.info(`Key Details: ${JSON.stringify(i,null,2)}`)}catch{f.error(t("Failed to get key details"))}},ae=o=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(o),Ne=()=>{a.backend_type||(a.backend_type="vault"),A.value=!0},rt=()=>{A.value=!1,U()},U=async()=>{try{const o=await Fe();if(console.log("KMS Status Response:",o),!o||o.status==="NotConfigured"){Object.assign(a,{backend_type:"",address:"",auth_type:"token",vault_token:"",vault_app_role_id:"",vault_app_role_secret_id:"",mount_path:"transit",kv_mount:"",key_path_prefix:"",cache_ttl_seconds:300,timeout_seconds:30,default_key_id:"",kms_status:"NotConfigured",kms_backend:null,kms_healthy:!1}),A.value=!0,f.info(t("KMS is not configured, please configure it first"));return}if(a.kms_status=o.status,a.kms_healthy=o.healthy,o.status!=="Running"&&(o.status==="Stopped"?f.warning(t("KMS service is stopped")):o.status==="Error"&&f.error(t("KMS service has errors"))),o.config_summary){const i=o.config_summary;if(console.log("Config Summary from Status:",i),console.log("Config Summary Type:",typeof i),console.log("Config Summary Keys:",Object.keys(i||{})),i.backend_summary?(console.log("Backend Summary:",i.backend_summary),console.log("Backend Summary Keys:",Object.keys(i.backend_summary)),i.backend_summary.backend_type==="vault"&&(console.log("Vault Config:",i.backend_summary),console.log("Vault Address:",i.backend_summary.address))):console.log("No backend_summary found in config_summary"),Object.assign(a,{backend_type:i.backend_type?.toLowerCase()||"vault",default_key_id:i.default_key_id||"",enable_cache:i.enable_cache!==void 0?i.enable_cache:!0,timeout_seconds:i.timeout_seconds||30,retry_attempts:i.retry_attempts||3}),i.cache_summary&&(a.cache_ttl_seconds=i.cache_summary.ttl_seconds||300),i.backend_summary){if(i.backend_summary.backend_type==="vault"){const p=i.backend_summary;Object.assign(a,{address:p.address||"",mount_path:p.mount_path||"transit",kv_mount:p.kv_mount||"secret",key_path_prefix:p.key_path_prefix||"rustfs/kms/keys"}),a.auth_type=p.auth_method_type==="approle"?"approle":"token",a.vault_token="***",a.vault_app_role_id="",a.vault_app_role_secret_id=""}else if(i.backend_summary.backend_type==="local"){const p=i.backend_summary;Object.assign(a,{key_directory:p.key_dir||"",has_master_key:p.has_master_key||!1,file_permissions:p.file_permissions})}}a.kms_backend={type:a.backend_type,address:a.address,mount_path:a.mount_path,kv_mount:a.kv_mount,key_path_prefix:a.key_path_prefix,auth_method:{type:"token"}},f.success(t("Configuration loaded successfully"))}else console.log("No config_summary in status response, KMS may be configured but details are private"),a.backend_type=o.backend_type?.toLowerCase()||"vault",a.default_key_id="configured-but-hidden",a.address="configured-but-hidden",a.kms_backend={type:a.backend_type,address:"configured-but-hidden",mount_path:"transit",kv_mount:"secret",key_path_prefix:"rustfs/kms/keys",auth_method:{type:"configured-but-hidden"}}}catch(o){console.error("Failed to load KMS status:",o),o instanceof Error&&o.message&&o.message.includes("KMS service not initialized")?(Object.assign(a,{backend_type:"",address:"",auth_type:"token",vault_token:"",vault_app_role_id:"",vault_app_role_secret_id:"",mount_path:"transit",kv_mount:"",key_path_prefix:"",cache_ttl_seconds:300,timeout_seconds:30,default_key_id:"",kms_status:"NotConfigured",kms_backend:null,kms_healthy:!1}),A.value=!0,f.info(t("KMS service not initialized, please configure it first"))):(A.value=!0,f.error(t("Failed to load KMS status")))}},z=async()=>{try{const o=await je();console.log("Key List Response:",o),console.log("Key List Response Type:",typeof o),console.log("Key List Response Keys:",Object.keys(o||{})),o&&o.success!==!1?(w.value=o.keys||[],console.log("Loaded keys:",w.value.length)):(console.log("Key list failed:",o),f.warning(o?.message||t("Failed to load key list")),w.value=[])}catch(o){console.error("Failed to load key list:",o),console.error("Error details:",{message:o?.message,status:o?.status,response:o?.response}),f.error(t("Failed to load key list")),w.value=[]}},it=async()=>{try{he.value=!0,await z(),f.success(t("Key list refreshed"))}catch(o){console.error("Failed to refresh key list:",o),f.error(t("Failed to refresh key list"))}finally{he.value=!1}},dt=()=>!a.address||!String(a.address).trim()?(f.error(t("Please enter Vault server address")),!1):!a.default_key_id||!String(a.default_key_id).trim()?(f.error(t("Please enter default key ID")),!1):a.auth_type==="token"&&(!a.vault_token||!String(a.vault_token).trim())?(f.error(t("Please enter Vault token")),!1):a.auth_type==="approle"&&(!a.vault_app_role_id||!String(a.vault_app_role_id).trim()||!a.vault_app_role_secret_id||!String(a.vault_app_role_secret_id).trim())?(f.error(t("Please enter both Role ID and Secret ID")),!1):!0,ut=()=>!C.keyName||!C.keyName.toString().trim()?(f.error(t("Please enter key name")),!1):!0,ct=()=>S.encryptionType?S.encryptionType==="SSE-KMS"&&!S.kmsKeyId?(f.error(t("Please select a KMS key for SSE-KMS encryption")),!1):M.value?!0:(f.error(t("No bucket selected")),!1):(f.error(t("Please select encryption type")),!1),_t=async()=>{if(dt())try{_e.value=!0;const o={backend_type:"vault",address:a.address,mount_path:a.mount_path,kv_mount:a.kv_mount,key_path_prefix:a.key_path_prefix,timeout_seconds:parseInt(a.timeout_seconds.toString())||30,retry_attempts:parseInt(a.retry_attempts.toString())||3,default_key_id:a.default_key_id||null,enable_cache:a.enable_cache,cache_ttl_seconds:a.cache_ttl_seconds||600};if(a.auth_type==="token")if(a.vault_token&&a.vault_token!=="***")o.auth_method={token:a.vault_token};else if(a.vault_token==="***")delete o.auth_method;else{f.error(t("Please enter Vault token"));return}else if(a.auth_type==="approle")if(a.vault_app_role_id&&a.vault_app_role_secret_id&&a.vault_app_role_id!=="***"&&a.vault_app_role_secret_id!=="***")o.auth_method={role_id:a.vault_app_role_id,secret_id:a.vault_app_role_secret_id};else if(a.vault_app_role_id==="***"||a.vault_app_role_secret_id==="***")delete o.auth_method;else{f.error(t("Please enter both Role ID and Secret ID"));return}else{f.error(t("Please select authentication method"));return}const i=await Be(o);i&&i.status&&(a.kms_status=i.status,i.success!==!1&&(a.kms_healthy=!0)),o.address&&(a.address=o.address),f.success(t("Configuration saved successfully")),A.value=!1,U()}catch(o){console.error("KMS Configuration save error:",o);let i=t("Failed to save configuration");if(o&&typeof o=="object"&&"message"in o)i+=`: ${o.message}`;else if(o&&typeof o=="object"&&"response"in o){const p=o.response;p?.data?.message?i+=`: ${p.data.message}`:p?.statusText&&(i+=`: ${p.statusText}`)}else typeof o=="string"&&(i+=`: ${o}`);f.error(i)}finally{_e.value=!1}},ft=o=>{if($(o)==="PendingDeletion"){f.info(t("Key is already pending deletion"));return}O.value=o,P.value=!0},mt=o=>{q.value=o,L.value=!0},pt=async()=>{if(ut())try{ve.value=!0;const o={KeyUsage:"EncryptDecrypt",Description:C.keyName?`${C.keyName} (${C.algorithm})`:`Master Key (${C.algorithm})`,Tags:{name:C.keyName,algorithm:C.algorithm,created_by:"console",created_at:new Date().toISOString()}};console.log("Creating key with data:",o);const i=await ze(o);console.log("Create key response:",i),f.success(t("Key created successfully")),F.value=!1,Object.assign(C,{keyName:"",algorithm:"AES-256"}),await z()}catch{f.error(t("Failed to save key"))}finally{ve.value=!1}},yt=async()=>{try{ge.value=!0,await Pe(O.value.key_id),f.success(t("Key deleted successfully")),P.value=!1,O.value=null,await z()}catch{f.error(t("Failed to delete key"))}finally{ge.value=!1}},vt=async()=>{try{X.value=!0,await Le(q.value.key_id),f.success(t("Key force deleted successfully")),L.value=!1,q.value=null,await z()}catch{f.error(t("Failed to force delete key"))}finally{X.value=!1}},gt=async()=>{try{fe.value=!0,await U(),f.success(t("Status refreshed successfully"))}catch{f.error(t("Failed to refresh status"))}finally{fe.value=!1}},ht=async()=>{try{me.value=!0;const o=await Oe();o.status==="success"?f.success(t("Cache cleared successfully")):f.warning(o.message||t("Cache clear completed with warnings"))}catch{f.error(t("Failed to clear cache"))}finally{me.value=!1}},kt=async()=>{try{const o=await qe();h.value=o,Y.value=!0}catch{f.error(t("Failed to get detailed status"))}};Ut(()=>a.backend_type,o=>{o==="vault"&&(a.mount_path="transit",a.timeout_seconds=30)});const xt=async()=>{try{pe.value=!0;const o=await $e();o&&o.success?(f.success(t("KMS service started successfully")),a.kms_status=o.status,await U(),await z()):f.error(t("Failed to start KMS service")+": "+(o?.message||"Unknown error"))}catch(o){console.error("Failed to start KMS service:",o),f.error(t("Failed to start KMS service"))}finally{pe.value=!1}},bt=async()=>{try{ye.value=!0;const o=await Ue();o&&o.success?(f.success(t("KMS service stopped successfully")),a.kms_status=o.status,await U()):f.error(t("Failed to stop KMS service")+": "+(o?.message||"Unknown error"))}catch(o){console.error("Failed to stop KMS service:",o),f.error(t("Failed to stop KMS service"))}finally{ye.value=!1}},le=async()=>{B.value=!0;try{const o=await He();if(o&&o.Buckets){const i=await Promise.all(o.Buckets.map(async p=>{try{const g=await Je(p.Name);let oe="Disabled",Q="",W="",V="";const d=(g?.ServerSideEncryptionConfiguration?.Rules??[])[0];if(d?.ApplyServerSideEncryptionByDefault){oe="Enabled";const T=d.ApplyServerSideEncryptionByDefault.SSEAlgorithm;T==="aws:kms"?(Q="SSE-KMS",W="AES-256 (KMS)",V=d.ApplyServerSideEncryptionByDefault.KMSMasterKeyID||""):T==="AES256"&&(Q="SSE-S3",W="AES-256 (S3)")}return{name:p.Name??"",creationDate:p.CreationDate,encryptionStatus:oe,encryptionType:Q,encryptionAlgorithm:W,kmsKeyId:V}}catch{return{name:p.Name??"",creationDate:p.CreationDate,encryptionStatus:"Disabled",encryptionType:"",encryptionAlgorithm:"",kmsKeyId:""}}}));Z.value=i}}catch(o){console.error("Failed to load bucket list:",o),f.error(t("Failed to load bucket list"))}finally{B.value=!1}},St=async()=>{await le(),f.success(t("Bucket list refreshed"))},Kt=o=>{M.value=o,o.encryptionStatus==="Enabled"?(S.encryptionType=o.encryptionType,S.kmsKeyId=o.kmsKeyId||""):(S.encryptionType="",S.kmsKeyId=""),G.value=!0},Ct=o=>{M.value=o,H.value=!0},wt=async()=>{if(ct())try{ke.value=!0;const o={Rules:[{ApplyServerSideEncryptionByDefault:{}}]};S.encryptionType==="SSE-KMS"?(o.Rules[0].ApplyServerSideEncryptionByDefault.SSEAlgorithm="aws:kms",o.Rules[0].ApplyServerSideEncryptionByDefault.KMSMasterKeyID=S.kmsKeyId):S.encryptionType==="SSE-S3"&&(o.Rules[0].ApplyServerSideEncryptionByDefault.SSEAlgorithm="AES256"),await Qe(M.value.name,o),f.success(t("Bucket encryption configured successfully")),G.value=!1,await le()}catch(o){console.error("Failed to configure bucket encryption:",o),f.error(t("Failed to configure bucket encryption")+": "+o.message)}finally{ke.value=!1}},Dt=async()=>{if(!M.value){f.error(t("No bucket selected"));return}xe.value=!0;try{await We(M.value.name),f.success(t("Bucket encryption removed successfully")),H.value=!1,await le()}catch(o){console.error("Failed to remove bucket encryption:",o),f.error(t("Failed to remove bucket encryption")+": "+o.message)}finally{xe.value=!1}},Mt=o=>{try{return new Date(o).toLocaleString()}catch{return o}};return zt(async()=>{await U(),a.kms_status==="Running"&&a.kms_healthy&&await z(),await le()}),(o,i)=>{const p=Et,g=Vt,oe=Tt,Q=At,W=Rt,V=Nt,Ie=It;return c(),E(Ie,null,{default:r(()=>[l(p,null,{description:r(()=>[n("p",Qt,s(e(t)("Configure server-side encryption for your objects using external key management services.")),1)]),default:r(()=>[n("h1",Jt,s(e(t)("Server-Side Encryption (SSE) Configuration")),1)]),_:1}),n("div",Wt,[l(e(re),{class:"shadow-none"},{default:r(()=>[l(e(de),{class:"space-y-2"},{default:r(()=>[n("div",Yt,[l(e(Ke),{class:"text-base sm:text-lg"},{default:r(()=>[u(s(e(t)("KMS Status Overview")),1)]),_:1}),l(e(N),{variant:we.value,class:"text-sm uppercase"},{default:r(()=>[u(s(Ee()),1)]),_:1},8,["variant"])]),l(e(ue),null,{default:r(()=>[u(s(ot()),1)]),_:1}),a.kms_backend?(c(),E(e(ue),{key:0},{default:r(()=>[u(s(e(t)("Backend"))+": "+s(a.backend_type),1)]),_:1})):m("",!0)]),_:1}),l(e(ie),{class:"space-y-4"},{default:r(()=>[n("div",Xt,[n("div",Zt,[n("p",es,s(e(t)("Backend Type")),1),n("p",ts,s(a.backend_type?Te(a.backend_type):e(t)("Not configured")),1)]),n("div",ss,[n("p",as,s(e(t)("Cache Status")),1),n("p",ls,s(a.enable_cache?e(t)("Enabled"):e(t)("Disabled")),1)]),n("div",os,[n("p",ns,s(e(t)("Default Key ID")),1),n("p",rs,s(a.default_key_id||e(t)("Not configured")),1)])]),n("div",is,[l(e(v),{size:"sm",variant:"outline",loading:fe.value,onClick:gt},{default:r(()=>[l(g,{name:"ri:refresh-line",class:"mr-2 size-4"}),u(" "+s(e(t)("Refresh")),1)]),_:1},8,["loading"]),l(e(v),{size:"sm",variant:"outline",disabled:a.kms_status!=="Running",loading:me.value,onClick:ht},{default:r(()=>[l(g,{name:"ri:delete-bin-line",class:"mr-2 size-4"}),u(" "+s(e(t)("Clear Cache")),1)]),_:1},8,["disabled","loading"]),l(e(v),{size:"sm",variant:"outline",disabled:a.kms_status!=="Running",onClick:kt},{default:r(()=>[l(g,{name:"ri:eye-line",class:"mr-2 size-4"}),u(" "+s(e(t)("Details")),1)]),_:1},8,["disabled"]),I.value&&(a.kms_status==="Configured"||se(a.kms_status))?(c(),E(e(v),{key:0,size:"sm",variant:"default",loading:pe.value,onClick:xt},{default:r(()=>[l(g,{name:"ri:play-line",class:"mr-2 size-4"}),u(" "+s(e(t)("Start KMS")),1)]),_:1},8,["loading"])):m("",!0),I.value&&a.kms_status==="Running"?(c(),E(e(v),{key:1,size:"sm",variant:"outline",loading:ye.value,onClick:bt},{default:r(()=>[l(g,{name:"ri:stop-line",class:"mr-2 size-4"}),u(" "+s(e(t)("Stop KMS")),1)]),_:1},8,["loading"])):m("",!0)])]),_:1})]),_:1}),l(e(re),{class:"shadow-none"},{default:r(()=>[l(e(de),{class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},{default:r(()=>[n("div",ds,[l(e(Ke),null,{default:r(()=>[u(s(e(t)("KMS Configuration")),1)]),_:1}),l(e(ue),null,{default:r(()=>[u(s(e(t)("Manage how RustFS connects to your external key management service.")),1)]),_:1})]),A.value?m("",!0):(c(),_("div",us,[l(e(v),{size:"sm",variant:"default",onClick:Ne},{default:r(()=>[u(s(I.value?e(t)("Edit Configuration"):e(t)("Configure KMS")),1)]),_:1})]))]),_:1}),l(e(ie),{class:"space-y-6"},{default:r(()=>[A.value?(c(),_("form",{key:1,class:"space-y-6",onSubmit:jt(_t,["prevent"])},[n("div",null,[n("p",Is,s(e(t)("KMS Type")),1),n("p",Fs,s(e(t)("HashiCorp Vault Transit Engine")),1)]),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-address"},{default:r(()=>[u(s(e(t)("Vault Server Address")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-address",modelValue:a.address,"onUpdate:modelValue":i[0]||(i[0]=d=>a.address=d),placeholder:e(t)("e.g., https://vault.example.com:8200"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("Authentication Method")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(Q,{modelValue:a.auth_type,"onUpdate:modelValue":i[1]||(i[1]=d=>a.auth_type=d),class:"grid gap-3 md:grid-cols-2"},{default:r(()=>[(c(!0),_(j,null,ne(tt.value,d=>(c(),_("label",{key:d.value,class:"flex items-start gap-3 rounded-md border border-border/50 p-3"},[l(oe,{value:d.value,class:"mt-0.5"},null,8,["value"]),n("span",Bs,[n("span",$s,s(d.label),1),d.description?(c(),_("span",Us,s(d.description),1)):m("",!0)])]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),a.auth_type==="token"?(c(),E(e(k),{key:0},{default:r(()=>[l(e(x),{for:"kms-token"},{default:r(()=>[u(s(e(t)("Vault Token")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-token",modelValue:a.vault_token,"onUpdate:modelValue":i[2]||(i[2]=d=>a.vault_token=d),type:"password",autocomplete:"off",placeholder:e(t)("Enter your Vault authentication token")},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Required: Vault authentication token")),1)]),_:1})]),_:1})):m("",!0),a.auth_type==="approle"?(c(),_("div",zs,[l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-role-id"},{default:r(()=>[u(s(e(t)("Role ID")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-role-id",modelValue:a.vault_app_role_id,"onUpdate:modelValue":i[3]||(i[3]=d=>a.vault_app_role_id=d),placeholder:e(t)("Enter AppRole Role ID"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("AppRole Role ID from Vault")),1)]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-secret-id"},{default:r(()=>[u(s(e(t)("Secret ID")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-secret-id",modelValue:a.vault_app_role_secret_id,"onUpdate:modelValue":i[4]||(i[4]=d=>a.vault_app_role_secret_id=d),type:"password",autocomplete:"off",placeholder:e(t)("Enter AppRole Secret ID")},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("AppRole Secret ID from Vault")),1)]),_:1})]),_:1})])):m("",!0),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-mount-path"},{default:r(()=>[u(s(e(t)("Transit Mount Path")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-mount-path",modelValue:a.mount_path,"onUpdate:modelValue":i[5]||(i[5]=d=>a.mount_path=d),placeholder:e(t)("transit"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Transit engine mount path, default: transit")),1)]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-kv-mount"},{default:r(()=>[u(s(e(t)("KV Mount Path")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-kv-mount",modelValue:a.kv_mount,"onUpdate:modelValue":i[6]||(i[6]=d=>a.kv_mount=d),placeholder:e(t)("secret"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("KV storage mount path, default: secret")),1)]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-key-prefix"},{default:r(()=>[u(s(e(t)("Key Path Prefix")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-key-prefix",modelValue:a.key_path_prefix,"onUpdate:modelValue":i[7]||(i[7]=d=>a.key_path_prefix=d),placeholder:e(t)("rustfs/kms/keys"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Key storage path prefix in KV store")),1)]),_:1})]),_:1}),n("div",js,[l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-timeout"},{default:r(()=>[u(s(e(t)("Timeout (seconds)")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-timeout",modelValue:a.timeout_seconds,"onUpdate:modelValue":i[8]||(i[8]=d=>a.timeout_seconds=d),type:"number",placeholder:"30"},null,8,["modelValue"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Request timeout in seconds, default: 30")),1)]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-retry"},{default:r(()=>[u(s(e(t)("Retry Attempts")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-retry",modelValue:a.retry_attempts,"onUpdate:modelValue":i[9]||(i[9]=d=>a.retry_attempts=d),type:"number",placeholder:"3"},null,8,["modelValue"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Number of retry attempts, default: 3")),1)]),_:1})]),_:1})]),l(e(k),null,{default:r(()=>[l(e(x),{for:"kms-default-key"},{default:r(()=>[u(s(e(t)("Default Key ID")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-default-key",modelValue:a.default_key_id,"onUpdate:modelValue":i[10]||(i[10]=d=>a.default_key_id=d),placeholder:e(t)("rustfs-master"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Default master key ID for SSE-KMS")),1)]),_:1})]),_:1}),l(e(k),{orientation:"responsive"},{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("Enable Cache")),1)]),_:1}),l(e(b),null,{default:r(()=>[n("div",Ps,[l(e(Ot),{modelValue:a.enable_cache,"onUpdate:modelValue":i[11]||(i[11]=d=>a.enable_cache=d)},null,8,["modelValue"])])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Enable caching for better performance, default: true")),1)]),_:1})]),_:1}),a.enable_cache?(c(),E(e(k),{key:2},{default:r(()=>[l(e(x),{for:"kms-cache-ttl"},{default:r(()=>[u(s(e(t)("Cache TTL (seconds)")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{id:"kms-cache-ttl",modelValue:a.cache_ttl_seconds,"onUpdate:modelValue":i[12]||(i[12]=d=>a.cache_ttl_seconds=d),type:"number",placeholder:"600"},null,8,["modelValue"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Cache time-to-live in seconds, default: 600")),1)]),_:1})]),_:1})):m("",!0),n("div",Ls,[l(e(v),{type:"button",variant:"outline",onClick:rt},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{type:"submit",variant:"default",loading:_e.value},{default:r(()=>[u(s(e(t)("Save Configuration")),1)]),_:1},8,["loading"])])],32)):(c(),_("div",cs,[a.backend_type?(c(),_("div",_s,[n("div",fs,[n("div",ms,[n("p",ps,s(e(t)("Current KMS Type"))+": "+s(Te(a.backend_type)),1),n("div",ys,[a.backend_type==="vault"?(c(),_(j,{key:0},[n("div",null,[u(s(e(t)("Vault Server"))+": ",1),a.address==="configured-but-hidden"?(c(),_("span",vs,s(e(t)("(Configuration details are private)")),1)):(c(),_("span",gs,s(a.address||e(t)("Not specified")),1))]),a.mount_path?(c(),_("div",hs,s(e(t)("Transit Mount"))+": "+s(a.mount_path),1)):m("",!0),a.kv_mount?(c(),_("div",ks,s(e(t)("KV Mount"))+": "+s(a.kv_mount),1)):m("",!0),a.key_path_prefix?(c(),_("div",xs,s(e(t)("Key Path Prefix"))+": "+s(a.key_path_prefix),1)):m("",!0),a.auth_type?(c(),_("div",bs,s(e(t)("Auth Method"))+": "+s(a.auth_type==="approle"?"AppRole":"Token"),1)):m("",!0)],64)):m("",!0),a.backend_type==="local"?(c(),_(j,{key:1},[a.key_directory?(c(),_("div",Ss,s(e(t)("Key Directory"))+": "+s(a.key_directory),1)):m("",!0),a.has_master_key!==void 0?(c(),_("div",Ks,s(e(t)("Master Key"))+": "+s(a.has_master_key?e(t)("Configured"):e(t)("Not configured")),1)):m("",!0)],64)):m("",!0),a.timeout_seconds?(c(),_("div",Cs,s(e(t)("Timeout"))+": "+s(a.timeout_seconds)+"s",1)):m("",!0),a.retry_attempts?(c(),_("div",ws,s(e(t)("Retry Attempts"))+": "+s(a.retry_attempts),1)):m("",!0),a.enable_cache!==void 0?(c(),_("div",Ds,s(e(t)("Cache Enabled"))+": "+s(a.enable_cache?e(t)("Yes"):e(t)("No")),1)):m("",!0),a.cache_ttl_seconds?(c(),_("div",Ms,s(e(t)("Cache TTL"))+": "+s(a.cache_ttl_seconds)+"s ",1)):m("",!0),a.default_key_id&&a.default_key_id!=="configured-but-hidden"?(c(),_("div",Es,s(e(t)("Default Key ID"))+": "+s(a.default_key_id),1)):a.default_key_id==="configured-but-hidden"?(c(),_("div",Vs,[u(s(e(t)("Default Key ID"))+": ",1),n("span",As,s(e(t)("(Configured)")),1)])):m("",!0),a.kms_status?(c(),_("div",Ts,[u(s(e(t)("Status"))+": ",1),l(e(N),{variant:we.value,class:"text-xs uppercase"},{default:r(()=>[u(s(Ee()),1)]),_:1},8,["variant"])])):m("",!0)])])])])):(c(),_("div",Rs,[l(g,{name:"ri:key-2-line",class:"mb-2 text-4xl"}),n("div",Ns,s(e(t)("No KMS configuration found")),1),l(e(v),{size:"sm",variant:"default",onClick:Ne},{default:r(()=>[u(s(e(t)("Configure KMS")),1)]),_:1})]))]))]),_:1})]),_:1}),l(e(re),{class:"shadow-none"},{default:r(()=>[l(e(de),{class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},{default:r(()=>[n("div",Os,[l(e(Ke),null,{default:r(()=>[u(s(e(t)("KMS Keys Management")),1)]),_:1}),l(e(ue),null,{default:r(()=>[u(s(e(t)("Create, rotate, and inspect the keys managed by your KMS backend.")),1)]),_:1})]),n("div",qs,[l(e(v),{size:"sm",variant:"outline",loading:he.value,disabled:a.kms_status!=="Running",onClick:it},{default:r(()=>[l(g,{name:"ri:refresh-line",class:"size-4"}),n("span",null,s(e(t)("Refresh")),1)]),_:1},8,["loading","disabled"]),l(e(v),{size:"sm",variant:"default",disabled:!Me.value,onClick:i[13]||(i[13]=d=>F.value=!0)},{default:r(()=>[l(g,{name:"ri:add-line",class:"size-4"}),n("span",null,s(e(t)("Create Key")),1)]),_:1},8,["disabled"])])]),_:1}),l(e(ie),{class:"space-y-6"},{default:r(()=>[n("div",Gs,[n("h4",Hs,s(e(t)("Understanding Key Types")),1),n("div",Js,[n("div",Qs,[n("div",Ws,[i[33]||(i[33]=n("div",{class:"w-3 h-3 bg-purple-500 rounded-full"},null,-1)),n("span",Ys,s(e(t)("Master Keys (CMK)")),1)]),n("p",Xs,s(e(t)("Top-level encryption keys used to encrypt data keys. Managed by KMS and never leave the system.")),1)]),n("div",Zs,[n("div",ea,[i[34]||(i[34]=n("div",{class:"w-3 h-3 bg-green-500 rounded-full"},null,-1)),n("span",ta,s(e(t)("Data Keys (DEK)")),1)]),n("p",sa,s(e(t)("Generated from master keys to encrypt your files. Automatically created when encrypting data.")),1)])])]),n("div",aa,[n("div",la,[i[35]||(i[35]=n("div",{class:"w-4 h-4 rounded-full bg-purple-500"},null,-1)),n("h3",oa,s(e(t)("Master Keys (CMK)")),1),l(e(N),{variant:"secondary"},{default:r(()=>[u(s(w.value.filter(d=>!d.key_type||d.key_type==="master"||d.key_type==="CMK").length),1)]),_:1})]),w.value.filter(d=>!d.key_type||d.key_type==="master"||d.key_type==="CMK").length>0?(c(),_("div",na,[(c(!0),_(j,null,ne(w.value.filter(d=>!d.key_type||d.key_type==="master"||d.key_type==="CMK"),d=>(c(),_("div",{key:d.key_id,class:"border-l-4 border-purple-500 border rounded-lg p-4 bg-purple-50 dark:bg-purple-900/10"},[n("div",ra,[n("div",ia,[n("div",da,[i[36]||(i[36]=n("div",{class:"w-3 h-3 bg-purple-500 rounded-full"},null,-1)),n("span",ua,s(e(t)("Master Key (CMK)")),1)]),n("div",ca,s(J(d)),1),n("div",_a,[n("div",null,s(e(t)("Key ID"))+": "+s(d.key_id),1),d.algorithm?(c(),_("div",fa,s(e(t)("Algorithm"))+": "+s(d.algorithm),1)):m("",!0),n("div",null,[u(s(e(t)("Status"))+": ",1),l(e(N),{variant:Ve(d)},{default:r(()=>[u(s(Ae(d)),1)]),_:2},1032,["variant"])]),d.createdAt?(c(),_("div",ma,s(e(t)("Created"))+": "+s(ae(new Date(d.createdAt))),1)):d.creation_date?(c(),_("div",pa,s(e(t)("Created"))+": "+s(ae(new Date(d.creation_date))),1)):m("",!0)])]),n("div",ya,[l(e(v),{size:"sm",variant:"outline",onClick:T=>Re(d.key_id)},{default:r(()=>[u(s(e(t)("Details")),1)]),_:1},8,["onClick"]),l(e(v),{size:"sm",variant:"destructive",disabled:$(d)==="PendingDeletion",onClick:T=>ft(d)},{default:r(()=>[u(s($(d)==="PendingDeletion"?e(t)("Deleting..."):e(t)("Delete")),1)]),_:2},1032,["disabled","onClick"]),$(d)==="PendingDeletion"?(c(),E(e(v),{key:0,size:"sm",variant:"destructive",class:"bg-destructive/10 text-destructive hover:bg-destructive/20",disabled:X.value,onClick:T=>mt(d)},{default:r(()=>[u(s(e(t)("Force Delete")),1)]),_:1},8,["disabled","onClick"])):m("",!0)])])]))),128))])):m("",!0)]),w.value.filter(d=>d.key_type==="data"||d.key_type==="DEK").length>0?(c(),_("div",va,[n("div",ga,[i[37]||(i[37]=n("div",{class:"w-4 h-4 bg-green-500 rounded-full"},null,-1)),n("h3",ha,s(e(t)("Data Keys (DEK)")),1),l(e(N),{variant:"secondary"},{default:r(()=>[u(s(w.value.filter(d=>d.key_type==="data"||d.key_type==="DEK").length),1)]),_:1})]),n("div",ka,[n("p",xa,s(e(t)("Data keys are automatically generated when encrypting files. They are encrypted by master keys and used for actual data encryption.")),1)]),n("div",ba,[(c(!0),_(j,null,ne(w.value.filter(d=>d.key_type==="data"||d.key_type==="DEK"),d=>(c(),_("div",{key:d.key_id,class:"border-l-4 border-green-500 border rounded-lg p-4 bg-green-50 dark:bg-green-900/10"},[n("div",Sa,[n("div",Ka,[n("div",Ca,[i[38]||(i[38]=n("div",{class:"w-3 h-3 bg-green-500 rounded-full"},null,-1)),n("span",wa,s(e(t)("Data Key (DEK)")),1)]),n("div",Da,s(J(d)),1),n("div",Ma,[n("div",null,s(e(t)("Key ID"))+": "+s(d.key_id),1),d.parent_key_id?(c(),_("div",Ea,s(e(t)("Master Key"))+": "+s(d.parent_key_id),1)):m("",!0),d.algorithm?(c(),_("div",Va,s(e(t)("Algorithm"))+": "+s(d.algorithm),1)):m("",!0),n("div",null,[u(s(e(t)("Status"))+": ",1),l(e(N),{variant:Ve(d)},{default:r(()=>[u(s(Ae(d)),1)]),_:2},1032,["variant"])]),d.createdAt?(c(),_("div",Aa,s(e(t)("Created"))+": "+s(ae(new Date(d.createdAt))),1)):d.creation_date?(c(),_("div",Ta,s(e(t)("Created"))+": "+s(ae(new Date(d.creation_date))),1)):m("",!0)])]),n("div",Ra,[l(e(v),{size:"sm",variant:"outline",onClick:T=>Re(d.key_id)},{default:r(()=>[u(s(e(t)("Details")),1)]),_:1},8,["onClick"])])])]))),128))])])):m("",!0),w.value.length===0?(c(),E(Pt,{key:1,title:e(t)("No KMS keys found"),description:e(t)("Create your first KMS key to get started"),icon:"ri:key-2-line",class:"py-12"},{default:r(()=>[l(e(v),{class:"mt-4",disabled:!Me.value,onClick:i[14]||(i[14]=d=>F.value=!0)},{default:r(()=>[u(s(e(t)("Create First Key")),1)]),_:1},8,["disabled"])]),_:1},8,["title","description"])):m("",!0)]),_:1})]),_:1}),l(e(re),{class:"mt-6 shadow-none"},{default:r(()=>[l(e(de),null,{default:r(()=>[n("div",Na,[n("h3",Ia,s(e(t)("Bucket Encryption Management")),1),l(e(v),{size:"sm",loading:B.value,onClick:St},{default:r(()=>[l(g,{name:"ri:refresh-line",class:"size-4"}),u(" "+s(e(t)("Refresh")),1)]),_:1},8,["loading"])])]),_:1}),l(e(ie),{class:"space-y-4"},{default:r(()=>[n("div",Fa,[l(W,{modelValue:ee.value,"onUpdate:modelValue":i[15]||(i[15]=d=>ee.value=d),placeholder:e(t)("Search buckets..."),clearable:"",class:"flex-1"},null,8,["modelValue","placeholder"]),l(ce,{modelValue:te.value,"onUpdate:modelValue":i[16]||(i[16]=d=>te.value=d),options:Xe.value,placeholder:e(t)("Sort by"),class:"w-full sm:w-40"},null,8,["modelValue","options","placeholder"])]),be.value.length>0?(c(),_("div",Ba,[(c(!0),_(j,null,ne(be.value,d=>(c(),_("div",{key:d.name,class:"rounded-lg border p-4"},[n("div",$a,[n("div",Ua,[n("div",za,[l(g,{name:"ri:folder-3-line",class:"text-lg text-blue-500"}),n("div",null,[n("h4",ja,s(d.name),1),n("div",Pa,s(e(t)("Created"))+": "+s(Mt(d.creationDate)),1)])])]),n("div",La,[n("div",Oa,[n("div",qa,s(e(t)("Encryption Status")),1),l(e(N),{variant:d.encryptionStatus==="Enabled"?"secondary":"outline"},{default:r(()=>[u(s(d.encryptionStatus==="Enabled"?d.encryptionType==="SSE-KMS"?"SSE-KMS":"SSE-S3":e(t)("Not configured")),1)]),_:2},1032,["variant"])]),n("div",Ga,[l(e(v),{size:"sm",variant:"default",onClick:T=>Kt(d)},{default:r(()=>[l(g,{name:"ri:lock-line",class:"size-4"}),u(" "+s(e(t)("Configure")),1)]),_:1},8,["onClick"]),d.encryptionStatus==="Enabled"?(c(),E(e(v),{key:0,size:"sm",variant:"destructive",class:"bg-destructive/10 text-destructive hover:bg-destructive/20",onClick:T=>Ct(d)},{default:r(()=>[l(g,{name:"ri:lock-unlock-line",class:"size-4"}),u(" "+s(e(t)("Remove")),1)]),_:1},8,["onClick"])):m("",!0)])])]),d.encryptionStatus==="Enabled"?(c(),_("div",Ha,[n("div",Ja,[n("div",null,[n("strong",null,s(e(t)("Algorithm"))+":",1),u(" "+s(d.encryptionAlgorithm),1)]),d.encryptionType==="SSE-KMS"&&d.kmsKeyId?(c(),_("div",Qa,[n("strong",null,s(e(t)("KMS Key ID"))+":",1),u(" "+s(d.kmsKeyId),1)])):m("",!0)])])):m("",!0)]))),128))])):!B.value&&Z.value.length===0?(c(),_("div",Wa,[l(g,{name:"ri:folder-2-line",class:"mb-2 mx-auto text-4xl"}),n("div",null,s(e(t)("No buckets found")),1),n("div",Ya,s(e(t)("Create your first bucket to configure encryption")),1)])):!B.value&&Z.value.length>0&&be.value.length===0?(c(),_("div",Xa,[l(g,{name:"ri:search-line",class:"mb-2 mx-auto text-4xl"}),n("div",null,s(e(t)("No buckets match your search")),1),n("div",Za,s(e(t)("Try adjusting your search terms")),1)])):m("",!0),B.value?(c(),_("div",el,[l(e(Lt),{class:"mx-auto size-6 text-muted-foreground"}),n("div",tl,s(e(t)("Loading buckets...")),1)])):m("",!0)]),_:1})]),_:1}),l(V,{modelValue:G.value,"onUpdate:modelValue":i[20]||(i[20]=d=>G.value=d),title:M.value?e(t)("Configure Encryption for {bucket}",{bucket:M.value.name}):e(t)("Configure Bucket Encryption"),size:"lg","close-on-backdrop":!1},{footer:r(()=>[n("div",ll,[l(e(v),{variant:"outline",onClick:i[19]||(i[19]=d=>G.value=!1)},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{variant:"default",loading:ke.value,onClick:wt},{default:r(()=>[u(s(e(t)("Configure Encryption")),1)]),_:1},8,["loading"])])]),default:r(()=>[n("div",sl,[l(e(k),null,{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("Encryption Type")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(ce,{modelValue:S.encryptionType,"onUpdate:modelValue":i[17]||(i[17]=d=>S.encryptionType=d),options:Ze.value,placeholder:e(t)("Select encryption type")},null,8,["modelValue","options","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Choose the encryption method for this bucket")),1)]),_:1})]),_:1}),S.encryptionType==="SSE-KMS"?(c(),E(e(k),{key:0},{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("KMS Key")),1)]),_:1}),l(e(b),{class:"space-y-1.5"},{default:r(()=>[l(ce,{modelValue:S.kmsKeyId,"onUpdate:modelValue":i[18]||(i[18]=d=>S.kmsKeyId=d),options:st.value,placeholder:e(t)("Select KMS key"),disabled:De.value},null,8,["modelValue","options","placeholder","disabled"]),De.value?(c(),_("span",al,s(e(t)("Loading keys...")),1)):m("",!0)]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Select the KMS key to use for encryption")),1)]),_:1})]),_:1})):m("",!0)])]),_:1},8,["modelValue","title"]),l(V,{modelValue:H.value,"onUpdate:modelValue":i[22]||(i[22]=d=>H.value=d),title:e(t)("Confirm Remove Encryption"),size:"lg","close-on-backdrop":!1},{footer:r(()=>[n("div",il,[l(e(v),{variant:"outline",onClick:i[21]||(i[21]=d=>H.value=!1)},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{variant:"destructive",loading:xe.value,onClick:Dt},{default:r(()=>[u(s(e(t)("Remove Encryption")),1)]),_:1},8,["loading"])])]),default:r(()=>[n("div",ol,[l(g,{name:"ri:alert-line",class:"text-4xl text-orange-500"}),n("div",nl,s(e(t)("Are you sure you want to remove encryption?")),1),M.value?(c(),_("div",rl,s(M.value.name),1)):m("",!0),n("p",null,s(e(t)("Future uploads to this bucket will not be encrypted by default.")),1),n("p",null,s(e(t)("Existing encrypted objects will remain encrypted.")),1)])]),_:1},8,["modelValue","title"]),l(V,{modelValue:F.value,"onUpdate:modelValue":i[26]||(i[26]=d=>F.value=d),title:e(t)("Create New Key"),size:"lg","close-on-backdrop":!1},{footer:r(()=>[n("div",ul,[l(e(v),{variant:"outline",onClick:i[25]||(i[25]=d=>F.value=!1)},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{variant:"default",loading:ve.value,onClick:pt},{default:r(()=>[u(s(e(t)("Create Key")),1)]),_:1},8,["loading"])])]),default:r(()=>[n("div",dl,[l(e(k),null,{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("Key Name")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(e(D),{modelValue:C.keyName,"onUpdate:modelValue":i[23]||(i[23]=d=>C.keyName=d),placeholder:e(t)("e.g., app-default"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Main key ID (Transit key name). Use business-related readable ID.")),1)]),_:1})]),_:1}),l(e(k),null,{default:r(()=>[l(e(x),null,{default:r(()=>[u(s(e(t)("Algorithm")),1)]),_:1}),l(e(b),null,{default:r(()=>[l(ce,{modelValue:C.algorithm,"onUpdate:modelValue":i[24]||(i[24]=d=>C.algorithm=d),options:et,placeholder:e(t)("Select encryption algorithm")},null,8,["modelValue","placeholder"])]),_:1}),l(e(K),null,{default:r(()=>[u(s(e(t)("Encryption algorithm for the key.")),1)]),_:1})]),_:1})])]),_:1},8,["modelValue","title"]),l(V,{modelValue:P.value,"onUpdate:modelValue":i[28]||(i[28]=d=>P.value=d),title:e(t)("Confirm Delete"),size:"lg","close-on-backdrop":!1},{footer:r(()=>[n("div",ml,[l(e(v),{variant:"outline",onClick:i[27]||(i[27]=d=>P.value=!1)},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{variant:"destructive",loading:ge.value,onClick:yt},{default:r(()=>[u(s(e(t)("Delete Key")),1)]),_:1},8,["loading"])])]),default:r(()=>[n("div",cl,[l(g,{name:"ri:alert-line",class:"text-4xl text-red-500"}),n("div",_l,s(e(t)("Are you sure you want to delete this key?")),1),O.value?(c(),_("div",fl,s(J(O.value)),1)):m("",!0),n("p",null,s(e(t)("This action cannot be undone.")),1)])]),_:1},8,["modelValue","title"]),l(V,{modelValue:L.value,"onUpdate:modelValue":i[30]||(i[30]=d=>L.value=d),title:e(t)("Confirm Force Delete"),size:"lg","close-on-backdrop":!1},{footer:r(()=>[n("div",hl,[l(e(v),{variant:"outline",onClick:i[29]||(i[29]=d=>L.value=!1)},{default:r(()=>[u(s(e(t)("Cancel")),1)]),_:1}),l(e(v),{variant:"destructive",loading:X.value,onClick:vt},{default:r(()=>[u(s(e(t)("Force Delete")),1)]),_:1},8,["loading"])])]),default:r(()=>[n("div",pl,[l(g,{name:"ri:alert-line",class:"text-4xl text-red-500"}),n("div",yl,s(e(t)("Are you sure you want to force delete this key?")),1),q.value?(c(),_("div",vl,s(J(q.value)),1)):m("",!0),n("div",gl,s(e(t)("WARNING: This will immediately delete the key")),1),n("p",null,s(e(t)("This action cannot be undone and will bypass the normal deletion process.")),1)])]),_:1},8,["modelValue","title"]),l(V,{modelValue:Y.value,"onUpdate:modelValue":i[32]||(i[32]=d=>Y.value=d),title:e(t)("Detailed KMS Status"),size:"lg"},{footer:r(()=>[n("div",Ql,[l(e(v),{variant:"outline",onClick:i[31]||(i[31]=d=>Y.value=!1)},{default:r(()=>[u(s(e(t)("Close")),1)]),_:1})])]),default:r(()=>[h.value?(c(),_("div",kl,[n("div",xl,[n("div",bl,[n("p",Sl,s(e(t)("Backend Type")),1),n("p",Kl,s(h.value.backend_type||"N/A"),1)]),n("div",Cl,[n("p",wl,s(e(t)("Backend Status")),1),n("p",Dl,s(h.value.backend_status||"N/A"),1)]),n("div",Ml,[n("p",El,s(e(t)("Cache Enabled")),1),l(e(N),{variant:h.value.cache_enabled?"secondary":"outline"},{default:r(()=>[u(s(h.value.cache_enabled?e(t)("Enabled"):e(t)("Disabled")),1)]),_:1},8,["variant"])]),n("div",Vl,[n("p",Al,s(e(t)("Default Key ID")),1),n("p",Tl,s(h.value.default_key_id||"N/A"),1)])]),h.value.cache_stats?(c(),_("div",Rl,[n("h4",Nl,s(e(t)("Cache Statistics")),1),n("div",Il,[n("div",Fl,[n("p",Bl,s(e(t)("Cache Hits")),1),n("p",$l,s(h.value.cache_stats.hit_count||0),1)]),n("div",Ul,[n("p",zl,s(e(t)("Cache Misses")),1),n("p",jl,s(h.value.cache_stats.miss_count||0),1)]),n("div",Pl,[n("p",Ll,s(e(t)("Hit Rate")),1),n("p",Ol,s(h.value.cache_stats.hit_count&&h.value.cache_stats.miss_count?(h.value.cache_stats.hit_count/(h.value.cache_stats.hit_count+h.value.cache_stats.miss_count)*100).toFixed(1)+"%":"N/A"),1)]),n("div",ql,[n("p",Gl,s(e(t)("Total Requests")),1),n("p",Hl,s((h.value.cache_stats.hit_count||0)+(h.value.cache_stats.miss_count||0)),1)])])])):m("",!0)])):(c(),_("div",Jl,s(e(t)("No status data available")),1))]),_:1},8,["modelValue","title"])])]),_:1})}}}),Ro=Ht(Wl,[["__scopeId","data-v-f74f8717"]]);export{Ro as default};
