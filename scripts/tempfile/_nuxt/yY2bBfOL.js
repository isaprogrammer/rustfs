import{_ as ce}from"./C-3P3SYp.js";import{e as se,i as ne,k as oe,r as T,x as de,A as Z,B as X,l as me,m as O,o as g,n as e,w as l,a as c,b as t,d as m,t as d,c as $,C as B,_ as k,F as ee,y as te,K as pe,L as j}from"./BvexhTZs.js";import M from"./B2MUHF3Z.js";import{_ as fe}from"./DvIOyMed.js";import{_ as _e}from"./a-pvK-AT.js";import{_ as ye}from"./DLtCItMV.js";import{_ as D,a as h,b as v}from"./CX0wwNc8.js";import{_ as xe}from"./QhSbJoSr.js";import{_ as C}from"./Te087XyE.js";import{_ as ve}from"./zIRx1Luc.js";import{_ as ge,a as ae,b as he}from"./CyvZY9pv.js";import{_ as le}from"./CADlXJMh.js";import{M as Ve}from"./D6QIHz9A.js";import{S as Q}from"./BqQ6eC6R.js";import{u as re}from"./DirN9_Lc.js";import{u as ke}from"./BeC7AbfF.js";import{_ as Te}from"./BmVW1-Kl.js";import{u as be,D as De}from"./BQKrPI31.js";import"./CIcvgKWt.js";import"./k0-rRQS5.js";import"./BaE5Zpvg.js";import"./CNS46M7W.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./DW7TBzO-.js";import"./CjRf5-Eg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";import"./CHIgUVhi.js";import"./BDEBxj3U.js";import"./DlAUqK2U.js";import"./CLsMh9cr.js";import"./DNxf501w.js";import"./DkygctF7.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./Baq5sz8T.js";const Ce={class:"space-y-6"},Ne={class:"space-y-4"},Se={class:"flex items-center justify-end gap-3"},Ue={class:"text-sm text-muted-foreground"},we={class:"space-y-4"},$e={class:"cursor-pointer text-sm font-medium text-primary"},Me={class:"mt-4 space-y-4"},Fe={class:"space-y-3"},Ee={class:"flex items-center justify-between"},Pe={key:0,class:"space-y-3"},ze={class:"flex items-center gap-2"},Be={key:0},je={class:"cursor-pointer text-sm font-medium text-primary"},Ae={class:"space-y-4"},Re={class:"flex items-center gap-3"},Ie={class:"text-sm text-muted-foreground"},Le={class:"space-y-4"},Oe={class:"cursor-pointer text-sm font-medium text-primary"},Ke={class:"mt-4 space-y-4"},qe={class:"space-y-3"},He={class:"flex items-center justify-between"},Je={key:0,class:"space-y-3"},We={class:"flex items-center gap-2"},Ge={class:"flex justify-end gap-2"},Qe=se({__name:"new-form",props:{bucketName:{}},emits:["search"],setup(K,{expose:i,emit:A}){const{t:n}=ne(),N=oe(),{putBucketLifecycleConfiguration:q,getBucketVersioning:H,getBucketLifecycleConfiguration:J}=re({}),{listTiers:x}=ke(),y=K,z=A,F=T(!1),E=T("expire"),b=T(!1),S=T(!1),R=de(()=>[{label:n("Current Version"),value:"current"},{label:n("Non-current Version"),value:"non-current"}]),U=Z({action:"expire"}),a=Z({versionType:"current",days:1,storageType:"",prefix:"",expiredDeleteMark:!1,tags:[{key:"",value:""}]});X(()=>E.value,u=>{U.action=u==="expire"?"expire":"transition"},{immediate:!0});const o=T([]),f=async()=>{const u=await x();u&&(o.value=u.map(s=>({label:s[s.type].name,value:s[s.type].name}))),!a.storageType&&o.value.length>0&&(a.storageType=o.value[0]?.value??"")},_=async()=>{if(!y.bucketName){S.value=!1;return}try{const u=await H(y.bucketName);S.value=u.Status==="Enabled"}catch{S.value=!1}};X(()=>y.bucketName,()=>{_()});const P=()=>{a.tags.push({key:"",value:""})},I=u=>{a.tags.length!==1&&a.tags.splice(u,1)},L=()=>{E.value="expire",U.action="expire",a.versionType="current",a.days=1,a.storageType=o.value[0]?.value??"",a.prefix="",a.expiredDeleteMark=!1,a.tags=[{key:"",value:""}]},W=()=>!a.days||Number(a.days)<1?(N.error(n("Please enter valid days")),!1):U.action==="transition"&&(!a.storageType||a.storageType==="")?(N.error(n("Please select storage type")),!1):(a.tags.some(u=>u.key&&u.value),!0),G=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,u=>{const s=Math.random()*16|0;return(u==="x"?s:s&3|8).toString(16)}),ie=()=>{const u=a.tags.filter(r=>r.key&&r.value);if(!a.prefix&&u.length===0)return;const s={},[p]=u;return p&&u.length===1&&!a.prefix?s.Tag={Key:p.key,Value:p.value}:u.length>0?(s.And={Tags:u.map(r=>({Key:r.key,Value:r.value}))},a.prefix&&(s.And.Prefix=a.prefix)):a.prefix&&(s.Prefix=a.prefix),a.prefix&&p&&u.length===1&&!s.And?(s.Prefix=a.prefix,s.Tag={Key:p.key,Value:p.value}):a.prefix&&u.length===0&&(s.Prefix=a.prefix),Object.keys(s).length?s:void 0},ue=async()=>{if(W()){if(!y.bucketName){N.error(n("Bucket name is required"));return}b.value=!0;try{const u=await J(y.bucketName),s={ID:G(),Status:"Enabled",Filter:ie()},p=Number(a.days);U.action==="expire"?a.versionType==="non-current"?(s.NoncurrentVersionExpiration={NoncurrentDays:p},a.expiredDeleteMark&&(s.ExpiredObjectDeleteMarker=!0)):(s.Expiration={Days:p},a.expiredDeleteMark&&(s.Expiration.ExpiredObjectDeleteMarker=!0)):a.versionType==="non-current"?s.NoncurrentVersionTransitions=[{NoncurrentDays:p,StorageClass:a.storageType}]:s.Transitions=[{Days:p,StorageClass:a.storageType}];const w={Rules:[...u.Rules||[],s]};await q(y.bucketName,w),N.success(n("Create Success")),z("search"),Y()}catch(u){N.error(u?.message||n("Failed to create rule"))}finally{b.value=!1}}},Y=()=>{F.value=!1,L()};return i({open:async()=>{await Promise.all([f(),_()]),L(),F.value=!0}}),me(()=>{f(),_()}),(u,s)=>{const p=xe;return g(),O(Ve,{modelValue:F.value,"onUpdate:modelValue":s[9]||(s[9]=r=>F.value=r),title:`${e(n)("Add Lifecycle Rule")} (${e(n)("Bucket")}: ${K.bucketName||""})`,size:"lg","close-on-backdrop":!1},{footer:l(()=>[c("div",Ge,[t(e(k),{variant:"outline",onClick:Y},{default:l(()=>[m(d(e(n)("Cancel")),1)]),_:1}),t(e(k),{variant:"default",loading:b.value,onClick:ue},{default:l(()=>[m(d(e(n)("Save")),1)]),_:1},8,["loading"])])]),default:l(()=>[c("div",Ce,[t(e(he),{modelValue:E.value,"onUpdate:modelValue":s[8]||(s[8]=r=>E.value=r),class:"flex flex-col gap-4"},{default:l(()=>[t(e(ge),{class:"w-full justify-start overflow-x-auto"},{default:l(()=>[t(e(ae),{value:"expire"},{default:l(()=>[m(d(e(n)("Expiration")),1)]),_:1}),t(e(ae),{value:"transition"},{default:l(()=>[m(d(e(n)("Transition")),1)]),_:1})]),_:1}),t(e(le),{value:"expire",class:"mt-0 space-y-6"},{default:l(()=>[c("div",Ne,[S.value?(g(),O(e(D),{key:0},{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Object Version")),1)]),_:1}),t(e(v),null,{default:l(()=>[t(Q,{modelValue:a.versionType,"onUpdate:modelValue":s[0]||(s[0]=r=>a.versionType=r),options:R.value},null,8,["modelValue","options"])]),_:1})]),_:1})):B("",!0),t(e(D),{orientation:"horizontal"},{default:l(()=>[t(e(v),null,{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Time Cycle")),1)]),_:1}),t(p,null,{default:l(()=>[m(d(e(n)("Set the time cycle for the rule")),1)]),_:1})]),_:1}),t(e(v),null,{default:l(()=>[c("div",Se,[t(e(C),{modelValue:a.days,"onUpdate:modelValue":s[1]||(s[1]=r=>a.days=r),type:"number",min:"1",class:"w-32",placeholder:e(n)("Days")},null,8,["modelValue","placeholder"]),c("span",Ue,d(e(n)("Days After")),1)])]),_:1})]),_:1})]),c("div",we,[c("details",null,[c("summary",$e,d(e(n)("More Configurations")),1),c("div",Me,[t(e(D),{orientation:"horizontal"},{default:l(()=>[t(e(v),null,{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Prefix")),1)]),_:1}),t(p,null,{default:l(()=>[m(d(e(n)("Set the prefix for the rule")),1)]),_:1})]),_:1}),t(e(v),null,{default:l(()=>[t(e(C),{modelValue:a.prefix,"onUpdate:modelValue":s[2]||(s[2]=r=>a.prefix=r),placeholder:e(n)("Please enter prefix")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),c("div",Fe,[c("div",Ee,[t(e(h),{class:"text-sm font-medium"},{default:l(()=>[m(d(e(n)("Tags")),1)]),_:1}),t(e(k),{variant:"outline",size:"sm",onClick:P},{default:l(()=>[t(e(M),{name:"ri:add-line",class:"size-4"}),m(" "+d(e(n)("Add Tag")),1)]),_:1})]),a.tags.length?(g(),$("div",Pe,[(g(!0),$(ee,null,te(a.tags,(r,w)=>(g(),$("div",{key:w,class:"grid gap-2 md:grid-cols-2 md:items-center md:gap-4"},[t(e(C),{modelValue:r.key,"onUpdate:modelValue":V=>r.key=V,placeholder:e(n)("Tag Name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),c("div",ze,[t(e(C),{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,placeholder:e(n)("Tag Value"),class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(e(k),{variant:"ghost",size:"sm",class:"text-destructive",disabled:a.tags.length===1,onClick:V=>I(w)},{default:l(()=>[t(e(M),{name:"ri:delete-bin-line",class:"size-4"})]),_:1},8,["disabled","onClick"])])]))),128))])):B("",!0)])])])]),a.versionType==="current"?(g(),$("div",Be,[c("details",null,[c("summary",je,d(e(n)("Advanced Settings")),1),t(e(D),{orientation:"horizontal",class:"mt-4"},{default:l(()=>[t(e(v),null,{default:l(()=>[t(e(h),{class:"text-sm font-medium"},{default:l(()=>[m(d(e(n)("Delete Marker Handling")),1)]),_:1}),t(p,null,{default:l(()=>[m(d(e(n)("If no versions remain, delete references to this object")),1)]),_:1})]),_:1}),t(e(v),null,{default:l(()=>[t(e(ve),{modelValue:a.expiredDeleteMark,"onUpdate:modelValue":s[3]||(s[3]=r=>a.expiredDeleteMark=r),class:"ml-auto"},null,8,["modelValue"])]),_:1})]),_:1})])])):B("",!0)]),_:1}),t(e(le),{value:"transition",class:"mt-0 space-y-6"},{default:l(()=>[c("div",Ae,[S.value?(g(),O(e(D),{key:0},{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Object Version")),1)]),_:1}),t(e(v),null,{default:l(()=>[t(Q,{modelValue:a.versionType,"onUpdate:modelValue":s[4]||(s[4]=r=>a.versionType=r),options:R.value},null,8,["modelValue","options"])]),_:1})]),_:1})):B("",!0),t(e(D),null,{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Time Cycle")),1)]),_:1}),t(e(v),null,{default:l(()=>[c("div",Re,[t(e(C),{modelValue:a.days,"onUpdate:modelValue":s[5]||(s[5]=r=>a.days=r),type:"number",min:"1",class:"w-32",placeholder:e(n)("Days")},null,8,["modelValue","placeholder"]),c("span",Ie,d(e(n)("Days After")),1)])]),_:1})]),_:1}),t(e(D),null,{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Storage Type")),1)]),_:1}),t(e(v),null,{default:l(()=>[t(Q,{modelValue:a.storageType,"onUpdate:modelValue":s[6]||(s[6]=r=>a.storageType=r),options:o.value,placeholder:e(n)("Please select storage type")},null,8,["modelValue","options","placeholder"])]),_:1})]),_:1})]),c("div",Le,[c("details",null,[c("summary",Oe,d(e(n)("More Configurations")),1),c("div",Ke,[t(e(D),null,{default:l(()=>[t(e(h),null,{default:l(()=>[m(d(e(n)("Prefix")),1)]),_:1}),t(e(v),null,{default:l(()=>[t(e(C),{modelValue:a.prefix,"onUpdate:modelValue":s[7]||(s[7]=r=>a.prefix=r),placeholder:e(n)("Please enter prefix")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),c("div",qe,[c("div",He,[t(e(h),{class:"text-sm font-medium"},{default:l(()=>[m(d(e(n)("Tags")),1)]),_:1}),t(e(k),{variant:"outline",size:"sm",onClick:P},{default:l(()=>[t(e(M),{name:"ri:add-line",class:"size-4"}),m(" "+d(e(n)("Add Tag")),1)]),_:1})]),a.tags.length?(g(),$("div",Je,[(g(!0),$(ee,null,te(a.tags,(r,w)=>(g(),$("div",{key:w,class:"grid gap-2 rounded-md border p-3 md:grid-cols-2 md:items-center md:gap-4"},[t(e(C),{modelValue:r.key,"onUpdate:modelValue":V=>r.key=V,placeholder:e(n)("Tag Name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),c("div",We,[t(e(C),{modelValue:r.value,"onUpdate:modelValue":V=>r.value=V,placeholder:e(n)("Tag Value"),class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(e(k),{variant:"ghost",size:"sm",class:"text-destructive",disabled:a.tags.length===1,onClick:V=>I(w)},{default:l(()=>[t(e(M),{name:"ri:delete-bin-line",class:"size-4"})]),_:1},8,["disabled","onClick"])])]))),128))])):B("",!0)])])])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue","title"])}}}),Xe=Object.assign(Qe,{__name:"LifecycleNewForm"}),Ye={class:"text-2xl font-bold"},zt=se({__name:"index",setup(K){const{t:i}=ne(),A=oe(),n=pe(),{getBucketLifecycleConfiguration:N,deleteBucketLifecycle:q,putBucketLifecycleConfiguration:H}=re({}),J=[{id:"type",header:()=>i("Type"),accessorFn:o=>o.Transitions||o.NoncurrentVersionTransitions?"Transition":"Expire"},{id:"version",header:()=>i("Version"),accessorFn:o=>o.NoncurrentVersionExpiration||o.NoncurrentVersionTransitions?i("Non-current Version"):i("Current Version")},{id:"deleteMarker",header:()=>i("Expiration Delete Mark"),accessorFn:o=>o.Expiration?.ExpiredObjectDeleteMarker?i("On"):i("Off")},{id:"tier",header:()=>i("Tier"),accessorFn:o=>o.Transitions?.[0]?.StorageClass||o.NoncurrentVersionTransitions?.[0]?.StorageClass||"--"},{id:"prefix",header:()=>i("Prefix"),accessorFn:o=>o.Filter?.Prefix||o.Filter?.And?.Prefix||""},{id:"timeCycle",header:()=>`${i("Time Cycle")} (${i("Days")})`,accessorFn:o=>o.Expiration?.Days||o.NoncurrentVersionExpiration?.NoncurrentDays||o.Transitions?.[0]?.Days||o.NoncurrentVersionTransitions?.[0]?.NoncurrentDays||""},{id:"status",header:()=>i("Status"),accessorFn:o=>o.Status||"-",cell:({row:o})=>j(ce,{variant:o.original.Status==="Enabled"?"secondary":"destructive"},()=>o.original.Status||"-")},{id:"actions",header:()=>i("Actions"),enableSorting:!1,cell:({row:o})=>j("div",{class:"flex items-center gap-2"},[j(k,{variant:"outline",size:"sm",onClick:()=>S(o.original)},()=>[j(M,{name:"ri:delete-bin-5-line",class:"size-4"}),j("span",i("Delete"))])])}],x=T(null),y=T([]),z=T(!1),{table:F}=be({data:y,columns:J,getRowId:o=>o.ID??JSON.stringify(o)}),E=async()=>{if(!x.value){y.value=[];return}z.value=!0;try{const f=[...(await N(x.value)).Rules??[]].map(_=>_).sort((_,P)=>(_.ID??"").localeCompare(P.ID??""));y.value=f}catch{y.value=[]}finally{z.value=!1}},b=async()=>{await E()};X(()=>x.value,()=>{b()},{immediate:!0});const S=o=>{n.error({title:i("Warning"),content:i("Are you sure you want to delete this rule?"),positiveText:i("Confirm"),negativeText:i("Cancel"),onPositiveClick:()=>R(o)})},R=async o=>{const f=y.value.filter(_=>_.ID!==o.ID);if(x.value)try{f.length===0?await q(x.value):await H(x.value,{Rules:f}),A.success(i("Delete Success")),await b()}catch(_){A.error(_?.message||i("Delete Failed"))}},U=T(),a=()=>{U.value?.open()};return(o,f)=>{const _=fe,P=_e,I=ye,L=Xe,W=Te;return g(),O(W,null,{default:l(()=>[t(I,null,{actions:l(()=>[t(P,{class:"w-full justify-end gap-3 sm:w-auto"},{default:l(()=>[t(_,{modelValue:x.value,"onUpdate:modelValue":f[0]||(f[0]=G=>x.value=G),placeholder:e(i)("Please select bucket"),"cache-key":"lifecycle-buckets"},null,8,["modelValue","placeholder"]),t(e(k),{variant:"outline",onClick:a},{default:l(()=>[t(e(M),{name:"ri:add-line",class:"size-4"}),c("span",null,d(e(i)("Add Lifecycle Rule")),1)]),_:1}),t(e(k),{variant:"outline",onClick:f[1]||(f[1]=()=>b())},{default:l(()=>[t(e(M),{name:"ri:refresh-line",class:"size-4"}),c("span",null,d(e(i)("Refresh")),1)]),_:1})]),_:1})]),default:l(()=>[c("h1",Ye,d(e(i)("Lifecycle")),1)]),_:1}),t(De,{table:e(F),"is-loading":z.value,"empty-title":e(i)("No Data"),"empty-description":e(i)("Create lifecycle rules to automate object transitions and expiration.")},null,8,["table","is-loading","empty-title","empty-description"]),t(L,{ref_key:"newRef",ref:U,bucketName:x.value,onSearch:f[2]||(f[2]=()=>b())},null,8,["bucketName"])]),_:1})}}});export{zt as default};
