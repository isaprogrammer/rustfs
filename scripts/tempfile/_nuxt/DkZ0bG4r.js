import{_ as te}from"./C-3P3SYp.js";import{e as H,i as J,k as W,r as P,A as le,x as L,m as Q,o as N,n as e,w as a,a as u,b as l,d as m,t as d,c as E,C as Z,_ as S,F as ae,y as se,K as ne,B as oe,L as x}from"./BvexhTZs.js";import U from"./B2MUHF3Z.js";import{_ as ie}from"./DvIOyMed.js";import{_ as re}from"./a-pvK-AT.js";import{_ as ue}from"./DLtCItMV.js";import{_}from"./Te087XyE.js";import{a as g,b as k,_ as v}from"./CX0wwNc8.js";import{_ as G}from"./zIRx1Luc.js";import{g as de}from"./BzVVdaTJ.js";import{M as ce}from"./D6QIHz9A.js";import{S as q}from"./BqQ6eC6R.js";import{u as X}from"./DirN9_Lc.js";import{_ as me}from"./BmVW1-Kl.js";import{u as pe,D as fe}from"./BQKrPI31.js";import"./CIcvgKWt.js";import"./k0-rRQS5.js";import"./BaE5Zpvg.js";import"./CNS46M7W.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./DW7TBzO-.js";import"./CjRf5-Eg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";import"./CHIgUVhi.js";import"./BDEBxj3U.js";import"./DlAUqK2U.js";import"./DNxf501w.js";import"./DkygctF7.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./Baq5sz8T.js";import"./CLsMh9cr.js";const _e={class:"space-y-6"},ge={class:"space-y-4"},ye={class:"grid gap-3 md:grid-cols-2"},ke={class:"space-y-3"},ve={class:"flex items-center justify-between"},be={key:0,class:"space-y-3"},xe={class:"flex items-center gap-2"},Ve={class:"space-y-4"},he={class:"flex items-center justify-between"},De={class:"text-sm font-medium"},we={class:"text-xs text-muted-foreground"},Re={class:"flex items-center justify-between"},Se={class:"text-sm font-medium"},Te={class:"text-xs text-muted-foreground"},Be={class:"flex items-center justify-between"},Ce={class:"text-sm font-medium"},Ne={class:"text-xs text-muted-foreground"},Pe={key:0,class:"space-y-3"},Ue={class:"flex items-center gap-2"},Ae={class:"flex justify-end gap-2"},je=H({__name:"new-form",props:{bucketName:{}},emits:["success"],setup(O,{expose:r,emit:A}){const{t:s}=J(),V=W(),{setRemoteReplicationTarget:M,putBucketReplication:$,getBucketReplication:F}=X({}),c=O,w=A,h=P(!1),T=P(!1),t=le({level:"1",endpoint:"",tls:!1,accesskey:"",secrretkey:"",bucket:"",region:"us-east-1",modeType:"async",timecheck:"60",unit:"Gi",bandwidth:100,storageType:"STANDARD",prefix:"",tags:[{key:"",value:""}],existingObject:!0,expiredDeleteMark:!0}),B=L(()=>[{label:s("Asynchronous"),value:"async"},{label:s("Synchronous"),value:"sync"}]),I=L(()=>[{label:"KiB/s",value:"Ki"},{label:"MiB/s",value:"Mi"},{label:"GiB/s",value:"Gi"}]),z=()=>{t.tags.push({key:"",value:""})},j=b=>{t.tags.length!==1&&t.tags.splice(b,1)},K=()=>{t.level="1",t.endpoint="",t.tls=!1,t.accesskey="",t.secrretkey="",t.bucket="",t.region="us-east-1",t.modeType="async",t.timecheck="60",t.unit="Gi",t.bandwidth=100,t.storageType="STANDARD",t.prefix="",t.tags=[{key:"",value:""}],t.existingObject=!0,t.expiredDeleteMark=!0},i=()=>t.endpoint?t.bucket?!t.accesskey||!t.secrretkey?(V.error(s("Please provide credentials")),!1):t.modeType==="async"&&Number(t.timecheck)<1?(V.error(s("Please enter valid health check interval")),!1):!0:(V.error(s("Please enter bucket")),!1):(V.error(s("Please enter endpoint")),!1),p=async()=>{if(i()){if(!c.bucketName){V.error(s("Bucket name is required"));return}T.value=!0;try{const b={sourcebucket:c.bucketName,endpoint:t.endpoint,credentials:{accessKey:t.accesskey,secretKey:t.secrretkey,expiration:"0001-01-01T00:00:00Z"},targetbucket:t.bucket,secure:t.tls,region:t.region,path:"auto",api:"s3v4",type:"replication",replicationSync:t.modeType==="sync",healthCheckDuration:Number(t.timecheck)||60,disableProxy:!1,resetBeforeDate:"0001-01-01T00:00:00Z",totalDowntime:0,lastOnline:"0001-01-01T00:00:00Z",isOnline:!1,latency:{curr:0,avg:0,max:0},edge:!1,edgeSyncBeforeExpiry:!1};t.modeType==="async"&&(b.bandwidth=Number(de(String(t.bandwidth),t.unit,!0))||0);const o=await M(c.bucketName,b);if(!o)throw new Error("Failed to create replication target");let n=null;try{n=await F(c.bucketName)}catch{n=null}const R={ID:`replication-rule-${Date.now()}`,Status:"Enabled",Priority:Number.parseInt(t.level)||1,SourceSelectionCriteria:{SseKmsEncryptedObjects:{Status:"Enabled"}},ExistingObjectReplication:{Status:t.existingObject?"Enabled":"Disabled"},DeleteMarkerReplication:{Status:t.expiredDeleteMark?"Enabled":"Disabled"},Destination:{Bucket:o,StorageClass:t.storageType||"STANDARD"}},y=t.tags.filter(f=>f.key&&f.value),C={};if(t.prefix&&(C.Prefix=t.prefix),y.length===1){const[f]=y;f&&(C.Tag={Key:f.key,Value:f.value})}else y.length>1&&(C.And={...t.prefix?{Prefix:t.prefix}:{},Tags:y.map(f=>({Key:f.key,Value:f.value}))},delete C.Prefix);Object.keys(C).length>0&&(R.Filter=C);const Y=n?.ReplicationConfiguration?.Rules??[],ee={Role:o,Rules:[...Y.filter(f=>f.Destination?.Bucket!==o),R]};await $(c.bucketName,ee),V.success(s("Create Success")),w("success"),D()}catch(b){console.error(b),V.error(b?.message||s("Save failed"))}finally{T.value=!1}}},D=()=>{h.value=!1,T.value=!1,K()};return r({open:()=>{K(),h.value=!0}}),(b,o)=>(N(),Q(ce,{modelValue:h.value,"onUpdate:modelValue":o[15]||(o[15]=n=>h.value=n),title:e(s)("Add Replication Rule")+` (${e(s)("Bucket")}: ${O.bucketName||""})`,size:"xl","close-on-backdrop":!1},{footer:a(()=>[u("div",Ae,[l(e(S),{variant:"outline",onClick:D},{default:a(()=>[m(d(e(s)("Cancel")),1)]),_:1}),l(e(S),{variant:"default",loading:T.value,onClick:p},{default:a(()=>[m(d(e(s)("Save")),1)]),_:1},8,["loading"])])]),default:a(()=>[u("div",_e,[u("div",ge,[u("div",ye,[l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Priority")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.level,"onUpdate:modelValue":o[0]||(o[0]=n=>t.level=n),type:"number",min:"1"},null,8,["modelValue"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Mode")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(q,{modelValue:t.modeType,"onUpdate:modelValue":o[1]||(o[1]=n=>t.modeType=n),options:B.value},null,8,["modelValue","options"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Endpoint")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.endpoint,"onUpdate:modelValue":o[2]||(o[2]=n=>t.endpoint=n),placeholder:e(s)("Please enter endpoint")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Bucket")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.bucket,"onUpdate:modelValue":o[3]||(o[3]=n=>t.bucket=n),placeholder:e(s)("Please enter bucket")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Access Key")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.accesskey,"onUpdate:modelValue":o[4]||(o[4]=n=>t.accesskey=n),placeholder:e(s)("Please enter Access Key"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Secret Key")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.secrretkey,"onUpdate:modelValue":o[5]||(o[5]=n=>t.secrretkey=n),type:"password",autocomplete:"off",placeholder:e(s)("Please enter Secret Key")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Region")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.region,"onUpdate:modelValue":o[6]||(o[6]=n=>t.region=n),placeholder:e(s)("Please enter region")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Storage Class")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.storageType,"onUpdate:modelValue":o[7]||(o[7]=n=>t.storageType=n),placeholder:e(s)("Please enter storage class")},null,8,["modelValue","placeholder"])]),_:1})]),_:1})]),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Prefix")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.prefix,"onUpdate:modelValue":o[8]||(o[8]=n=>t.prefix=n),placeholder:e(s)("Please enter prefix")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),u("div",ke,[u("div",ve,[l(e(g),{class:"text-sm font-medium"},{default:a(()=>[m(d(e(s)("Tags")),1)]),_:1}),l(e(S),{variant:"outline",size:"sm",onClick:z},{default:a(()=>[l(e(U),{name:"ri:add-line",class:"size-4"}),m(" "+d(e(s)("Add Tag")),1)]),_:1})]),t.tags.length?(N(),E("div",be,[(N(!0),E(ae,null,se(t.tags,(n,R)=>(N(),E("div",{key:R,class:"grid gap-2 rounded-md border p-3 md:grid-cols-2 md:items-center md:gap-4"},[l(e(_),{modelValue:n.key,"onUpdate:modelValue":y=>n.key=y,placeholder:e(s)("Tag Name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u("div",xe,[l(e(_),{modelValue:n.value,"onUpdate:modelValue":y=>n.value=y,placeholder:e(s)("Tag Value"),class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),l(e(S),{variant:"ghost",size:"sm",class:"text-destructive",disabled:t.tags.length===1,onClick:y=>j(R)},{default:a(()=>[l(e(U),{name:"ri:delete-bin-line",class:"size-4"})]),_:1},8,["disabled","onClick"])])]))),128))])):Z("",!0)])]),u("div",Ve,[u("div",he,[u("div",null,[u("p",De,d(e(s)("Use TLS")),1),u("p",we,d(e(s)("Enable secure transport when connecting to endpoint.")),1)]),l(e(G),{modelValue:t.tls,"onUpdate:modelValue":o[9]||(o[9]=n=>t.tls=n)},null,8,["modelValue"])]),u("div",Re,[u("div",null,[u("p",Se,d(e(s)("Replicate Existing Objects")),1),u("p",Te,d(e(s)("Include objects that already exist in the source bucket.")),1)]),l(e(G),{modelValue:t.existingObject,"onUpdate:modelValue":o[10]||(o[10]=n=>t.existingObject=n)},null,8,["modelValue"])]),u("div",Be,[u("div",null,[u("p",Ce,d(e(s)("Replicate Delete Markers")),1),u("p",Ne,d(e(s)("Sync delete markers to destination bucket.")),1)]),l(e(G),{modelValue:t.expiredDeleteMark,"onUpdate:modelValue":o[11]||(o[11]=n=>t.expiredDeleteMark=n)},null,8,["modelValue"])]),t.modeType==="async"?(N(),E("div",Pe,[l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Health Check Interval (seconds)")),1)]),_:1}),l(e(k),null,{default:a(()=>[l(e(_),{modelValue:t.timecheck,"onUpdate:modelValue":o[12]||(o[12]=n=>t.timecheck=n),type:"number",min:"1",class:"w-32"},null,8,["modelValue"])]),_:1})]),_:1}),l(e(v),null,{default:a(()=>[l(e(g),null,{default:a(()=>[m(d(e(s)("Bandwidth Limit")),1)]),_:1}),l(e(k),null,{default:a(()=>[u("div",Ue,[l(e(_),{modelValue:t.bandwidth,"onUpdate:modelValue":o[13]||(o[13]=n=>t.bandwidth=n),type:"number",min:"0",class:"w-32"},null,8,["modelValue"]),l(q,{modelValue:t.unit,"onUpdate:modelValue":o[14]||(o[14]=n=>t.unit=n),options:I.value,class:"w-28"},null,8,["modelValue","options"])])]),_:1})]),_:1})])):Z("",!0)])])]),_:1},8,["modelValue","title"]))}}),Ke=Object.assign(je,{__name:"ReplicationNewForm"}),Ee={class:"text-2xl font-bold"},kt=H({__name:"index",setup(O){const{t:r}=J(),A=W(),s=ne(),{getBucketReplication:V,putBucketReplication:M,deleteBucketReplication:$,deleteRemoteReplicationTarget:F}=X({}),c=P(null),w=P([]),h=P(!1),T=[{accessorKey:"ID",header:()=>r("Rule ID"),cell:({row:i})=>x("span",i.original.ID||"-")},{accessorKey:"Status",header:()=>r("Status"),cell:({row:i})=>x(te,{variant:i.original.Status==="Enabled"?"secondary":"outline"},()=>i.original.Status==="Enabled"?r("Enabled"):r("Disabled"))},{accessorKey:"Priority",header:()=>r("Priority"),cell:({row:i})=>x("span",String(i.original.Priority??"-"))},{accessorKey:"Filter",header:()=>r("Prefix"),cell:({row:i})=>x("span",i.original.Filter?.Prefix||"-")},{id:"destination-bucket",header:()=>r("Destination Bucket"),cell:({row:i})=>{const p=i.original.Destination?.Bucket||"";return x("span",p.replace(/^arn:aws:s3:::/,"")||"-")}},{id:"destination-storage",header:()=>r("Storage Class"),cell:({row:i})=>x("span",i.original.Destination?.StorageClass||"-")},{id:"actions",header:()=>r("Actions"),enableSorting:!1,cell:({row:i})=>x("div",{class:"flex items-center gap-2"},[x(S,{variant:"outline",size:"sm",onClick:()=>I(i.original)},()=>[x(U,{name:"ri:delete-bin-7-line",class:"size-4"}),x("span",r("Delete"))])])}],{table:t}=pe({data:w,columns:T,getRowId:i=>i.ID??JSON.stringify(i)}),B=async()=>{if(!c.value){w.value=[];return}h.value=!0;try{const i=await V(c.value);w.value=i?.ReplicationConfiguration?.Rules??[]}catch{w.value=[]}finally{h.value=!1}};oe(()=>c.value,()=>{B()},{immediate:!0});const I=i=>{s.error({title:r("Warning"),content:r("Are you sure you want to delete this replication rule?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>z(i)})},z=async i=>{const p=w.value.filter(D=>D!==i);if(c.value)try{p.length===0?(await $(c.value),await F(c.value,i.Destination?.Bucket??"")):await M(c.value,{Rules:p}),A.success(r("Delete Success")),await B()}catch(D){A.error(D?.message||r("Delete Failed"))}},j=P(),K=()=>{j.value?.open()};return(i,p)=>{const D=ie,b=re,o=ue,n=Ke,R=me;return N(),Q(R,null,{default:a(()=>[l(o,null,{actions:a(()=>[l(b,{class:"w-full justify-end gap-3 sm:w-auto"},{default:a(()=>[l(D,{modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=y=>c.value=y),placeholder:e(r)("Please select bucket"),"selector-class":"sm:w-56","cache-key":"replication-buckets"},null,8,["modelValue","placeholder"]),l(e(S),{variant:"outline",onClick:K},{default:a(()=>[l(e(U),{name:"ri:add-line",class:"size-4"}),u("span",null,d(e(r)("Add Replication Rule")),1)]),_:1}),l(e(S),{variant:"outline",onClick:p[1]||(p[1]=()=>B())},{default:a(()=>[l(e(U),{name:"ri:refresh-line",class:"size-4"}),u("span",null,d(e(r)("Refresh")),1)]),_:1})]),_:1})]),default:a(()=>[u("h1",Ee,d(e(r)("Bucket Replication")),1)]),_:1}),l(fe,{table:e(t),"is-loading":h.value,"empty-title":e(r)("No Data"),"empty-description":e(r)("Add replication rules to sync objects across buckets.")},null,8,["table","is-loading","empty-title","empty-description"]),l(n,{ref_key:"addFormRef",ref:j,bucketName:c.value,onSuccess:p[2]||(p[2]=()=>B())},null,8,["bucketName"])]),_:1})}}});export{kt as default};
