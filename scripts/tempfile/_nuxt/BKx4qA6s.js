import{_ as ae}from"./C-3P3SYp.js";import{e as j,i as Y,k as G,r as k,A as R,x as Z,B as K,m as g,o as u,n as t,w as l,a as o,c as O,F as B,y as F,t as m,b as r,C as L,d as A,_ as V,K as ne,h as se,L as y}from"./BvexhTZs.js";import P from"./B2MUHF3Z.js";import{_ as oe}from"./DJZ-4X_g.js";import{_ as le}from"./DLtCItMV.js";import{_ as D}from"./Te087XyE.js";import{a as W,b as q,_ as z}from"./CX0wwNc8.js";import{_ as re}from"./QhSbJoSr.js";import{M as ie}from"./D6QIHz9A.js";import{u as J}from"./C0Cf6JZT.js";import{_ as ce}from"./BmVW1-Kl.js";import{u as me,D as de}from"./BQKrPI31.js";import{u as ue}from"./BDEBxj3U.js";import"./D10rQJ_b.js";import"./DlAUqK2U.js";import"./DNxf501w.js";import"./CNS46M7W.js";import"./DkygctF7.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./CUw6zPDB.js";import"./k0-rRQS5.js";import"./CjRf5-Eg.js";import"./CHIgUVhi.js";import"./Baq5sz8T.js";import"./DW7TBzO-.js";import"./DUVp9UZ0.js";import"./CLsMh9cr.js";const pe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='45.923'%20height='45.923'%20viewBox='0%200%2045.923%2045.923'%3e%3cdefs%3e%3cstyle%3e.a{fill:%23fff;}.b{fill:%23606;}%3c/style%3e%3c/defs%3e%3cpath%20class='a'%20d='M46,25.927v7.016h.136A34.792,34.792,0,0,1,80.969,67.3h6.813A41.859,41.859,0,0,0,46,25.927Zm0,14.485v7.016h.136A20.246,20.246,0,0,1,66.393,67.3h6.813A27.3,27.3,0,0,0,46,40.412Zm45.9,8.737V35a60.59,60.59,0,0,0-6.043-7.2A59.1,59.1,0,0,0,77.936,21.4H62.907A49.439,49.439,0,0,1,91.9,49.149Z'%20transform='translate(-45.977%20-21.4)'/%3e%3cpath%20class='b'%20d='M46.036,47.428H45.9V64.992A2.318,2.318,0,0,0,48.209,67.3H66.293A20.231,20.231,0,0,0,46.036,47.428Zm0-14.485H45.9v7.469A27.283,27.283,0,0,1,73.105,67.3h7.741a34.743,34.743,0,0,0-34.81-34.358ZM91.823,65.015V49.149A49.463,49.463,0,0,0,62.852,21.4H48.209A2.318,2.318,0,0,0,45.9,23.709v2.241A41.8,41.8,0,0,1,87.659,67.323h1.856a2.318,2.318,0,0,0,2.309-2.309ZM85.78,27.805A64.821,64.821,0,0,1,91.823,35V23.686A2.279,2.279,0,0,0,89.537,21.4H77.881A57.512,57.512,0,0,1,85.78,27.805Z'%20transform='translate(-45.9%20-21.4)'/%3e%3c/svg%3e",_e="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='46.215'%20height='43.025'%20viewBox='0%200%2046.215%2043.025'%3e%3cdefs%3e%3cstyle%3e.a{fill:%23c83b51;}.b{fill:%23696969;}%3c/style%3e%3c/defs%3e%3cpath%20class='a'%20d='M51.317,19.006c-1.922,3.232-3.764,6.361-5.644,9.467a2.475,2.475,0,0,0-.336,2.461A4.6,4.6,0,0,1,42.076,37.2a4.7,4.7,0,0,1-5.786-3.9A4.8,4.8,0,0,1,40.562,27.9c.233-.033.471-.037.863-.066l4.232-7.1C43,18.094,41.411,15,41.762,11.166a10.884,10.884,0,0,1,3.261-6.972,11.072,11.072,0,0,1,13.815-1.45,10.755,10.755,0,0,1,4.5,12.508L59.475,14.2a7.332,7.332,0,0,0-1.56-6.7,6.691,6.691,0,0,0-4.189-2.191,6.814,6.814,0,0,0-7.443,4.823c-1.083,3.647.556,6.627,5.034,8.872Z'%20transform='translate(-29.658%20-0.973)'/%3e%3cpath%20class='b'%20d='M110.984,45.394l4.092,7.218a11.141,11.141,0,0,1,10.238,19.58,10.958,10.958,0,0,1-14.294-1.423l3.154-2.639c3.97,2.571,7.443,2.45,10.021-.595a6.909,6.909,0,0,0-.111-9.014c-2.611-2.935-6.107-3.024-10.334-.207-1.753-3.111-3.537-6.2-5.235-9.329a3.184,3.184,0,0,0-2.495-1.892,4.439,4.439,0,0,1-3.63-4.3,4.685,4.685,0,0,1,8.337-3.174,4.409,4.409,0,0,1,.814,4.364c-.15.447-.345.879-.556,1.409Z'%20transform='translate(-83.835%20-31.182)'/%3e%3cpath%20class='b'%20d='M30.387,129.273H22.094a11.364,11.364,0,0,1-5.47,7.587,11.06,11.06,0,0,1-7.417,1.321A11.269,11.269,0,0,1,.029,128.1a11.154,11.154,0,0,1,8.548-11.649c.353,1.281.709,2.575,1.062,3.853-4.688,2.392-6.311,5.406-5,9.175a6.83,6.83,0,0,0,8,4.431c3.638-.718,5.473-3.742,5.249-8.594,3.449,0,6.9-.036,10.35.018a3.779,3.779,0,0,0,3.4-1.306,4.471,4.471,0,0,1,6.545.068,4.7,4.7,0,1,1-6.795,6.5A16.224,16.224,0,0,1,30.387,129.273Z'%20transform='translate(-0.001%20-95.529)'/%3e%3c/svg%3e",fe={class:"space-y-6"},ve={key:0,class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye=["onClick"],ge={class:"flex items-center gap-3 p-4"},he=["src"],be={class:"text-base font-semibold"},Te={class:"text-sm text-muted-foreground"},xe={key:1,class:"space-y-4"},Ee=["src"],we={class:"flex flex-col"},Ae={class:"text-sm text-muted-foreground"},ke={class:"text-base font-semibold"},Ve={class:"grid gap-4"},Ce={class:"flex justify-end gap-2"},Me=j({__name:"new-form",emits:["search"],setup(X,{expose:h,emit:C}){const{t:e}=Y(),{updateEventTarget:M}=J(),v=G(),$=[{label:e("MQTT"),value:"MQTT",iconUrl:pe,description:e("Send events via MQTT broker")},{label:e("Webhook"),value:"Webhook",iconUrl:_e,description:e("Trigger custom HTTP endpoints")}],b={MQTT:[{label:e("MQTT_BROKER"),name:"broker",type:"text"},{label:e("MQTT_TOPIC"),name:"topic",type:"text"},{label:e("MQTT_USERNAME"),name:"username",type:"text"},{label:e("MQTT_PASSWORD"),name:"password",type:"password"},{label:e("MQTT_QOS"),name:"qos",type:"number"},{label:e("MQTT_RECONNECT_INTERVAL"),name:"reconnect_interval",type:"number"},{label:e("MQTT_KEEP_ALIVE_INTERVAL"),name:"keep_alive_interval",type:"number"},{label:e("MQTT_QUEUE_DIR"),name:"queue_dir",type:"text"},{label:e("MQTT_QUEUE_LIMIT"),name:"queue_limit",type:"number"},{label:e("COMMENT_KEY"),name:"comment",type:"text"}],Webhook:[{label:e("WEBHOOK_ENDPOINT"),name:"endpoint",type:"text"},{label:e("WEBHOOK_AUTH_TOKEN"),name:"auth_token",type:"text"},{label:e("WEBHOOK_QUEUE_LIMIT"),name:"queue_limit",type:"number"},{label:e("WEBHOOK_QUEUE_DIR"),name:"queue_dir",type:"text"},{label:e("COMMENT_KEY"),name:"comment",type:"text"}]},_=k(!1),T=k(!1),n=R({type:"",name:"",config:{}}),d=R({name:""}),I=Z(()=>n.type?b[n.type]??[]:[]);K(()=>n.type,i=>{if(i&&b[i]){const c={};b[i].forEach(a=>{c[a.name]=""}),n.config=c}});const N=Z(()=>$.find(i=>i.value===n.type)?.iconUrl||""),x=i=>{n.type=i},E=()=>{n.type="",n.name="",n.config={},Q()},Q=()=>{d.name=""},w=()=>{if(!n.name){d.name=e("Please enter name");return}/^[A-Za-z0-9_]+$/.test(n.name)?d.name="":d.name=e("Please enter name")+" (A-Z,0-9,_)"},S=()=>(w(),n.type?d.name?(v.error(d.name),!1):Object.values(n.config).some(c=>c!==""&&c!==null&&c!==void 0)?!0:(v.error(e("Please fill in at least one configuration item")),!1):(v.error(e("Please select event target type")),!1)),s=async()=>{if(S()){T.value=!0;try{const i=n.type==="MQTT"?"notify_mqtt":"notify_webhook",c=n.name,f={key_values:Object.entries(n.config).map(([ee,te])=>({key:ee,value:String(te??"")}))};await M(i,c,f),v.success(e("Event Target created successfully")),H(),U()}catch(i){console.error(i),v.error(e("Failed to create event target"))}finally{T.value=!1}}},p=C,H=()=>p("search"),U=()=>{_.value=!1,E()};return h({open:()=>{_.value=!0,E()}}),(i,c)=>(u(),g(ie,{modelValue:_.value,"onUpdate:modelValue":c[1]||(c[1]=a=>_.value=a),title:n.type?t(e)("Add {type} Destination",{type:n.type}):t(e)("Add Event Destination"),size:"lg","close-on-backdrop":!1},{footer:l(()=>[o("div",Ce,[r(t(V),{variant:"outline",onClick:U},{default:l(()=>[A(m(t(e)("Cancel")),1)]),_:1}),r(t(V),{variant:"default",loading:T.value,disabled:!n.type,onClick:s},{default:l(()=>[A(m(t(e)("Save")),1)]),_:1},8,["loading","disabled"])])]),default:l(()=>[o("div",fe,[n.type?(u(),O("div",xe,[o("div",{class:"flex cursor-pointer items-center gap-3 p-4 border transition hover:border-primary",onClick:E},[o("img",{src:N.value,class:"h-10 w-10",alt:""},null,8,Ee),o("div",we,[o("span",Ae,m(t(e)("Selected Type")),1),o("span",ke,m(n.type),1)])]),o("div",Ve,[r(t(z),null,{default:l(()=>[r(t(W),{for:"target-name"},{default:l(()=>[A(m(t(e)("Name"))+" (A-Z,0-9,_)",1)]),_:1}),r(t(q),null,{default:l(()=>[r(t(D),{id:"target-name",modelValue:n.name,"onUpdate:modelValue":c[0]||(c[0]=a=>n.name=a),placeholder:t(e)("Please enter name"),autocomplete:"off",onInput:w},null,8,["modelValue","placeholder"])]),_:1}),d.name?(u(),g(t(re),{key:0,class:"text-destructive"},{default:l(()=>[A(m(d.name),1)]),_:1})):L("",!0)]),_:1}),(u(!0),O(B,null,F(I.value,a=>(u(),g(t(z),{key:a.name},{default:l(()=>[r(t(W),{for:`config-${a.name}`},{default:l(()=>[A(m(a.label),1)]),_:2},1032,["for"]),r(t(q),null,{default:l(()=>[a.type==="text"?(u(),g(t(D),{key:0,id:`config-${a.name}`,modelValue:n.config[a.name],"onUpdate:modelValue":f=>n.config[a.name]=f,placeholder:`${t(e)("Please enter")} ${a.label.toLowerCase()}`},null,8,["id","modelValue","onUpdate:modelValue","placeholder"])):a.type==="password"?(u(),g(t(D),{key:1,id:`config-${a.name}`,modelValue:n.config[a.name],"onUpdate:modelValue":f=>n.config[a.name]=f,type:"password",autocomplete:"off",placeholder:`${t(e)("Please enter")} ${a.label.toLowerCase()}`},null,8,["id","modelValue","onUpdate:modelValue","placeholder"])):a.type==="number"?(u(),g(t(D),{key:2,id:`config-${a.name}`,modelValue:n.config[a.name],"onUpdate:modelValue":f=>n.config[a.name]=f,type:"number",placeholder:`${t(e)("Please enter")} ${a.label.toLowerCase()}`},null,8,["id","modelValue","onUpdate:modelValue","placeholder"])):L("",!0)]),_:2},1024)]),_:2},1024))),128))])])):(u(),O("div",ve,[(u(),O(B,null,F($,a=>o("div",{key:a.value,class:"cursor-pointer border border-border/70 transition hover:border-primary",onClick:f=>x(a.value)},[o("div",ge,[o("img",{src:a.iconUrl,class:"h-10 w-10",alt:""},null,8,he),o("div",null,[o("p",be,m(a.label),1),o("p",Te,m(a.description),1)])])],8,ye)),64))]))])]),_:1},8,["modelValue","title"]))}}),$e=Object.assign(Me,{__name:"EventsTargetNewForm"}),Ue={class:"text-2xl font-bold"},Oe={class:"w-full sm:max-w-xs"},rt=j({__name:"index",async setup(X){let h,C;const{t:e}=Y(),M=G(),v=ne(),{getEventsTargetList:$,deleteEventTarget:b}=J(),_=k(""),T=[{accessorKey:"account_id",header:()=>e("Event Destinations"),cell:({row:s})=>y("span",{class:"font-mono text-sm"},s.original.account_id),filterFn:"includesString"},{accessorKey:"service",header:()=>e("Type"),cell:({row:s})=>y("span",s.original.service)},{accessorKey:"status",header:()=>e("Status"),cell:({row:s})=>y(ae,{variant:s.original.status==="enable"?"secondary":"outline"},()=>s.original.status==="enable"?e("Enabled"):s.original.status||"-")},{id:"actions",header:()=>e("Actions"),enableSorting:!1,enableHiding:!1,meta:{width:90},cell:({row:s})=>y("div",{class:"flex items-center gap-2"},[y(V,{variant:"outline",size:"sm",onClick:()=>E(s.original)},()=>[y(P,{name:"ri:delete-bin-5-line",class:"size-4"}),y("span",e("Delete"))])])}],n=k([]),{table:d}=me({data:n,columns:T,getRowId:s=>`${s.service}-${s.account_id}`});K(_,s=>{d.getColumn("account_id")?.setFilterValue(s||void 0)});const{data:I,pending:N,refresh:x}=([h,C]=se(async()=>ue("events-targets",async()=>(await $()).notification_endpoints??[],{default:()=>[],server:!1})),h=await h,C(),h);K(()=>I.value,s=>{n.value=s??[]},{immediate:!0});const E=s=>{v.error({title:e("Warning"),content:e("Are you sure you want to delete this destination?"),positiveText:e("Confirm"),negativeText:e("Cancel"),onPositiveClick:()=>Q(s)})},Q=async s=>{try{await b(`notify_${s.service}`,s.account_id),M.success(e("Delete Success")),x()}catch(p){console.error(p),M.error(e("Delete Failed"))}},w=k(),S=()=>{w.value?.open()};return(s,p)=>{const H=oe,U=le,i=$e,c=ce;return u(),g(c,null,{default:l(()=>[r(U,null,{actions:l(()=>[o("div",Oe,[r(H,{modelValue:_.value,"onUpdate:modelValue":p[0]||(p[0]=a=>_.value=a),placeholder:t(e)("Search"),clearable:"",class:"w-full"},null,8,["modelValue","placeholder"])]),r(t(V),{variant:"outline",onClick:S},{default:l(()=>[r(t(P),{name:"ri:add-line",class:"size-4"}),o("span",null,m(t(e)("Add Event Destination")),1)]),_:1}),r(t(V),{variant:"outline",onClick:p[1]||(p[1]=()=>t(x)())},{default:l(()=>[r(t(P),{name:"ri:refresh-line",class:"size-4"}),o("span",null,m(t(e)("Refresh")),1)]),_:1})]),default:l(()=>[o("h1",Ue,m(t(e)("Event Destinations")),1)]),_:1}),r(de,{table:t(d),"is-loading":t(N),"empty-title":t(e)("No Destinations"),"empty-description":t(e)("Create an event destination to forward notifications.")},null,8,["table","is-loading","empty-title","empty-description"]),r(i,{ref_key:"newFormRef",ref:w,onSearch:p[2]||(p[2]=()=>t(x)())},null,512)]),_:1})}}});export{rt as default};
