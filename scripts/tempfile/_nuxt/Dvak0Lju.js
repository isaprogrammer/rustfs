import{_ as Y}from"./DLtCItMV.js";import{_ as J}from"./BmVW1-Kl.js";import{e as E,c as I,o as m,Y as L,I as B,n as e,X as O,r as $,a as i,b as s,M as Q,k as G,i as K,aF as ee,x as P,m as k,w as t,t as l,F as D,y as S,d as v,_ as M,C as Z}from"./BvexhTZs.js";import y from"./B2MUHF3Z.js";import{_ as ae,a as se}from"./B7PJQQ8H.js";import{_ as te}from"./C1EK1XPj.js";import{_ as A,a as F}from"./57wGRvWu.js";import{_ as N,a as T,b as U}from"./Ckea6FOO.js";import{b as oe,_ as le,a as ne}from"./CyvZY9pv.js";import{_ as V}from"./CADlXJMh.js";import{e as re}from"./CFMWe0vH.js";import"./DlAUqK2U.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./CLsMh9cr.js";const j=E({__name:"CardFooter",props:{class:{}},setup(u){const a=u;return(d,n)=>(m(),I("div",{class:B(e(O)("flex items-center p-6 pt-0",a.class))},[L(d.$slots,"default")],2))}}),ie=["accept","disabled"],ce=E({__name:"upload-zone",props:{accept:{default:void 0},disabled:{type:Boolean,default:!1},class:{default:void 0},icon:{default:"ri:upload-cloud-2-line"}},emits:["change"],setup(u,{emit:a}){const d=u,n=a,_=$(!1),h=o=>{if(!o||o.length===0){n("change",null);return}n("change",o[0]??null)},f=o=>{const x=o.target;h(x.files),x.value=""},g=o=>{d.disabled||(o.preventDefault(),_.value=!1,h(o.dataTransfer?.files))},b=o=>{d.disabled||(o.preventDefault(),_.value=!0)},c=()=>{_.value=!1};return(o,x)=>(m(),I("label",{class:B(e(O)("flex flex-col items-center justify-center gap-3 rounded-lg border border-dashed border-border/70 px-6 py-10 text-center transition hover:border-primary focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",_.value&&!u.disabled&&"border-primary bg-primary/5",u.disabled&&"pointer-events-none opacity-60",d.class)),onDrop:g,onDragover:b,onDragleave:c},[i("input",{type:"file",accept:u.accept,class:"hidden",disabled:u.disabled,onChange:f},null,40,ie),s(e(y),{name:u.icon,class:"h-12 w-12 text-muted-foreground"},null,8,["name"]),L(o.$slots,"default")],34))}}),ue=Object.assign(ce,{__name:"UploadZone"}),de=()=>{const{$api:u}=Q(),a=G(),{t:d}=K(),n=$(!1),_=async()=>{try{n.value=!0;const f=await u.request("/export-iam",{method:"GET",headers:{Accept:"application/zip"}},!1),b=`iam-config-export-${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.zip`,o={data:await f.blob(),headers:{"content-type":"application/zip",filename:encodeURIComponent(b)}};re(o,b),a.success(d("IAM configuration exported successfully"))}catch(f){console.error("IAM export error:",f),a.error(f.message||d("Failed to export IAM configuration"))}finally{n.value=!1}},h=async f=>{try{n.value=!0,await u.request("/import-iam",{method:"PUT",body:f,headers:{"Content-Type":"application/zip"}},!1),a.success(d("IAM configuration imported successfully"))}catch(g){console.error("IAM import error:",g),a.error(g.message||d("Failed to import IAM configuration"))}finally{n.value=!1}};return{isLoading:ee(n),exportIamConfig:_,importIamConfig:h}},fe={class:"text-2xl font-bold"},pe={class:"flex flex-col gap-6"},me={class:"grid gap-4 sm:grid-cols-2"},_e={class:"text-sm font-medium text-foreground"},ge={class:"text-sm text-muted-foreground"},xe={class:"space-y-3"},ve={class:"text-base font-medium"},he={class:"text-sm text-muted-foreground"},be={key:0,class:"text-sm text-destructive"},ye={class:"text-sm font-medium text-foreground"},Ie={class:"text-xs text-muted-foreground"},Ce={class:"text-sm text-muted-foreground"},we=10*1024*1024,Ve=E({__name:"index",setup(u){const{t:a}=K(),d=G(),{isLoading:n,exportIamConfig:_,importIamConfig:h}=de(),f=$("export"),g=P(()=>[{key:"export",label:a("Export")},{key:"import",label:a("Import")}]),b=P(()=>[{label:"Users",icon:"ri:user-line",iconClass:"text-blue-500"},{label:"User Groups",icon:"ri:group-line",iconClass:"text-green-500"},{label:"IAM Policies",icon:"ri:shield-line",iconClass:"text-purple-500"},{label:"AK/SK",icon:"ri:key-line",iconClass:"text-orange-500"}]),c=$(null),o=$(""),x=()=>{c.value=null,o.value=""},R=r=>r?r.name.toLowerCase().endsWith(".zip")?r.size>we?(o.value=a("File size exceeds limit (10MB)"),!1):(o.value="",!0):(o.value=a("Only ZIP files are supported, and file size should not exceed 10MB"),!1):!1,q=r=>{if(!r){x();return}R(r)?c.value=r:c.value=null},X=async()=>{try{await _()}catch(r){console.error("Export failed:",r)}},H=async()=>{if(c.value)try{await h(c.value),d.success(a("Import Success")),x()}catch(r){console.error("Import failed:",r)}},W=r=>{if(r<1024)return`${r} B`;const C=["KB","MB","GB"];let w=r,z=-1;do w/=1024,z++;while(w>=1024&&z<C.length-1);return`${w.toFixed(1)} ${C[z]}`};return(r,C)=>{const w=Y,z=J;return m(),k(z,null,{default:t(()=>[s(w,null,{default:t(()=>[i("h1",fe,l(e(a)("Import/Export")),1)]),_:1}),i("div",pe,[s(e(oe),{modelValue:f.value,"onUpdate:modelValue":C[0]||(C[0]=p=>f.value=p),class:"flex flex-col gap-6"},{default:t(()=>[s(e(le),{class:"w-full justify-start overflow-x-auto"},{default:t(()=>[(m(!0),I(D,null,S(g.value,p=>(m(),k(e(ne),{key:p.key,value:p.key,class:"capitalize"},{default:t(()=>[v(l(p.label),1)]),_:2},1032,["value"]))),128))]),_:1}),s(e(V),{value:"export",class:"mt-0"},{default:t(()=>[s(e(A),{class:"shadow-none"},{default:t(()=>[s(e(N),{class:"space-y-1"},{default:t(()=>[s(e(T),null,{default:t(()=>[v(l(e(a)("IAM Configuration Export")),1)]),_:1}),s(e(U),null,{default:t(()=>[v(l(e(a)("Export all IAM configurations including users, groups, policies, and access keys in a ZIP file.")),1)]),_:1})]),_:1}),s(e(F),{class:"space-y-6"},{default:t(()=>[i("div",me,[(m(!0),I(D,null,S(b.value,p=>(m(),I("div",{key:p.label,class:"flex items-center gap-3 rounded-md border bg-muted/40 p-3"},[s(e(y),{name:p.icon,class:B([p.iconClass,"size-5"])},null,8,["name","class"]),i("span",_e,l(e(a)(p.label)),1)]))),128))]),s(e(ae),null,{default:t(()=>[s(e(y),{name:"ri:information-line",class:"h-4 w-4"}),s(e(te),null,{default:t(()=>[v(l(e(a)("Notice")),1)]),_:1}),s(e(se),null,{default:t(()=>[v(l(e(a)("The exported file contains sensitive information. Please keep it secure.")),1)]),_:1})]),_:1})]),_:1}),s(e(j),{class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},{default:t(()=>[i("div",ge,l(e(a)("Download complete IAM configuration as ZIP file")),1),s(e(M),{variant:"default",size:"lg",loading:e(n),disabled:e(n),onClick:X},{default:t(()=>[s(e(y),{name:"ri:download-2-line",class:"size-4"}),i("span",null,l(e(n)?e(a)("Exporting..."):e(a)("Export Now")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),s(e(V),{value:"import",class:"mt-0"},{default:t(()=>[s(e(A),{class:"shadow-none"},{default:t(()=>[s(e(N),{class:"space-y-1"},{default:t(()=>[s(e(T),null,{default:t(()=>[v(l(e(a)("IAM Configuration Import")),1)]),_:1}),s(e(U),null,{default:t(()=>[v(l(e(a)("Import IAM configurations from a previously exported ZIP file.")),1)]),_:1})]),_:1}),s(e(F),{class:"space-y-4"},{default:t(()=>[i("div",xe,[s(ue,{accept:".zip",disabled:e(n),class:"border-dashed",onChange:q},{default:t(()=>[i("p",ve,l(e(a)("Click or drag ZIP file to this area to upload")),1),i("p",he,l(e(a)("Only ZIP files are supported, and file size should not exceed 10MB")),1)]),_:1},8,["disabled"]),o.value?(m(),I("p",be,l(o.value),1)):Z("",!0),c.value?(m(),k(e(A),{key:1,class:"border-dashed bg-muted/30 shadow-none"},{default:t(()=>[s(e(F),{class:"flex items-start justify-between gap-3 py-4"},{default:t(()=>[i("div",null,[i("p",ye,l(c.value.name),1),i("p",Ie,l(W(c.value.size)),1)]),s(e(M),{variant:"ghost",size:"icon-sm",class:"text-destructive",onClick:x},{default:t(()=>[s(e(y),{name:"ri:close-line",class:"size-4"})]),_:1})]),_:1})]),_:1})):Z("",!0)])]),_:1}),s(e(j),{class:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},{default:t(()=>[i("div",Ce,l(c.value?e(a)("Ready to import: {filename}",{filename:c.value.name}):e(a)("Please select a ZIP file to import")),1),s(e(M),{variant:"default",size:"lg",loading:e(n),disabled:e(n)||!c.value,onClick:H},{default:t(()=>[s(e(y),{name:"ri:upload-2-line",class:"size-4"}),i("span",null,l(e(n)?e(a)("Importing..."):e(a)("Import Now")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}});export{Ve as default};
