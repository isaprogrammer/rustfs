import{_ as ye}from"./C-3P3SYp.js";import{e as W,i as G,k as L,M as _e,A as H,r as y,x as F,m as S,o as k,n as e,w as l,a as w,b as t,C as I,d as f,t as u,_ as $,K as ve,B as ge,l as xe,L as b}from"./BvexhTZs.js";import B from"./B2MUHF3Z.js";import{_ as Ke}from"./DJZ-4X_g.js";import{_ as be}from"./DLtCItMV.js";import{_ as X}from"./DlpFS5KH.js";import{_ as z}from"./Te087XyE.js";import{_ as ee}from"./CjRf5-Eg.js";import{u as q,D as te,_ as Ve}from"./9WduX5_a.js";import{a as v,b as g,_ as x}from"./CX0wwNc8.js";import{_ as J}from"./QhSbJoSr.js";import{_ as le}from"./zIRx1Luc.js";import{_ as ae}from"./CdtAKlFY.js";import{M as se}from"./D6QIHz9A.js";import{m as Q}from"./BzVVdaTJ.js";import{d as Y}from"./CqtTy1rW.js";import{A as Se}from"./C71BMDLf.js";import{_ as ke}from"./BmVW1-Kl.js";import{D as we}from"./Br9_p3OE.js";import{u as Ae,D as De}from"./BQKrPI31.js";import"./D10rQJ_b.js";import"./DlAUqK2U.js";import"./CNS46M7W.js";import"./aZk9Io0G.js";import"./CFMWe0vH.js";import"./DW7TBzO-.js";import"./DUVp9UZ0.js";import"./CUw6zPDB.js";import"./DNxf501w.js";import"./DkygctF7.js";import"./Bg3I8jjh.js";import"./BqQ6eC6R.js";import"./CIcvgKWt.js";import"./k0-rRQS5.js";import"./BaE5Zpvg.js";import"./BAYMBq5_.js";import"./CtKdyHjI.js";import"./CHIgUVhi.js";import"./CzQd9PUz.js";import"./6l0Pl64a.js";import"./Baq5sz8T.js";import"./CLsMh9cr.js";const Pe={class:"space-y-4"},he={class:"text-xs text-muted-foreground"},Ce={class:"flex justify-end gap-2"},Ue=W({__name:"new-item",props:{visible:{type:Boolean}},emits:["update:visible","search","notice"],setup(Z,{emit:i}){const{t:c}=G(),d=L(),{$api:N}=_e(),{createServiceAccount:R}=q(),P=i,h=()=>({accessKey:Q(20),secretKey:Q(40),name:"",description:"",expiry:null,policy:"",impliedPolicy:!0}),s=H(h()),a=H({accessKey:"",secretKey:"",expiry:"",name:""}),_=y(!1),C=F({get(){return Z.visible},set(r){V(r)}}),A=F(()=>new Date().toISOString());function j(){Object.assign(s,h()),s.policy=JSON.stringify(n.value),D()}function D(){a.accessKey="",a.secretKey="",a.expiry="",a.name=""}function V(r=!1){P("update:visible",r),r||j()}function M(){return D(),s.accessKey?(s.accessKey.length<3||s.accessKey.length>20)&&(a.accessKey=c("Access Key length must be between 3 and 20 characters")):a.accessKey=c("Please enter Access Key"),s.secretKey?(s.secretKey.length<8||s.secretKey.length>40)&&(a.secretKey=c("Secret Key length must be between 8 and 40 characters")):a.secretKey=c("Please enter Secret Key"),s.name||(a.name=c("Please enter name")),!a.accessKey&&!a.secretKey&&!a.name}async function K(){if(!M()){d.error(c("Please fill in the correct format"));return}_.value=!0;try{let r=null;if(!s.impliedPolicy)try{r=JSON.stringify(JSON.parse(s.policy||"{}"))}catch{d.error(c("Policy format invalid")),_.value=!1;return}const m={...s,policy:r,expiration:s.expiry?s.expiry:"9999-01-01T00:00:00.000Z"},O=await R(m);d.success(c("Added successfully")),P("notice",O),V(),P("search")}catch(r){console.error(r),d.error(c("Add failed"))}finally{_.value=!1}}const n=y("");return(async()=>{const r=await N.get("/accountinfo");n.value=r.Policy,s.policy=JSON.stringify(r.Policy)})(),(r,m)=>{const O=X;return k(),S(se,{modelValue:C.value,"onUpdate:modelValue":m[8]||(m[8]=p=>C.value=p),title:e(c)("Create Key"),size:"lg","close-on-backdrop":!1},{footer:l(()=>[w("div",Ce,[t(e($),{variant:"outline",onClick:m[7]||(m[7]=p=>V())},{default:l(()=>[f(u(e(c)("Cancel")),1)]),_:1}),t(e($),{variant:"default",disabled:_.value,onClick:K},{default:l(()=>[_.value?(k(),S(e(ee),{key:0,class:"size-4"})):I("",!0),w("span",null,u(e(c)("Submit")),1)]),_:1},8,["disabled"])])]),default:l(()=>[w("div",Pe,[t(e(x),null,{default:l(()=>[t(e(v),{for:"create-access-key"},{default:l(()=>[f(u(e(c)("Access Key")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(z),{id:"create-access-key",modelValue:s.accessKey,"onUpdate:modelValue":m[0]||(m[0]=p=>s.accessKey=p),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a.accessKey?(k(),S(e(J),{key:0,class:"text-destructive"},{default:l(()=>[f(u(a.accessKey),1)]),_:1})):I("",!0)]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),{for:"create-secret-key"},{default:l(()=>[f(u(e(c)("Secret Key")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(z),{id:"create-secret-key",modelValue:s.secretKey,"onUpdate:modelValue":m[1]||(m[1]=p=>s.secretKey=p),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a.secretKey?(k(),S(e(J),{key:0,class:"text-destructive"},{default:l(()=>[f(u(a.secretKey),1)]),_:1})):I("",!0)]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),{for:"create-expiry"},{default:l(()=>[f(u(e(c)("Expiry"))+"("+u(e(c)("empty is indicates permanent validity"))+")",1)]),_:1}),t(e(g),null,{default:l(()=>[t(te,{id:"create-expiry",modelValue:s.expiry,"onUpdate:modelValue":m[2]||(m[2]=p=>s.expiry=p),min:A.value,placeholder:e(c)("Please select expiry date")},null,8,["modelValue","min","placeholder"])]),_:1}),a.expiry?(k(),S(e(J),{key:0,class:"text-destructive"},{default:l(()=>[f(u(a.expiry),1)]),_:1})):I("",!0)]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),{for:"create-name"},{default:l(()=>[f(u(e(c)("Name")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(z),{id:"create-name",modelValue:s.name,"onUpdate:modelValue":m[3]||(m[3]=p=>s.name=p),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a.name?(k(),S(e(J),{key:0,class:"text-destructive"},{default:l(()=>[f(u(a.name),1)]),_:1})):I("",!0)]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),{for:"create-description"},{default:l(()=>[f(u(e(c)("Description")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(ae),{id:"create-description",modelValue:s.description,"onUpdate:modelValue":m[4]||(m[4]=p=>s.description=p),rows:3},null,8,["modelValue"])]),_:1})]),_:1}),t(e(x),{orientation:"responsive",class:"items-start gap-3 rounded-md border p-3"},{default:l(()=>[t(e(v),{class:"text-sm font-medium"},{default:l(()=>[f(u(e(c)("Use main account policy")),1)]),_:1}),t(e(g),{class:"flex flex-col items-start gap-2 sm:flex-row sm:items-center sm:justify-between sm:gap-3"},{default:l(()=>[w("p",he,u(e(c)("Automatically inherit the main account policy when enabled.")),1),t(e(le),{modelValue:s.impliedPolicy,"onUpdate:modelValue":m[5]||(m[5]=p=>s.impliedPolicy=p)},null,8,["modelValue"])]),_:1})]),_:1}),s.impliedPolicy?I("",!0):(k(),S(e(x),{key:0},{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(c)("Current user policy")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(O,{modelValue:s.policy,"onUpdate:modelValue":m[6]||(m[6]=p=>s.policy=p)},null,8,["modelValue"])]),_:1})]),_:1}))])]),_:1},8,["modelValue","title"])}}}),Ie=Object.assign(Ue,{__name:"AccessKeysNewItem"}),$e={class:"space-y-4"},Ne={class:"flex justify-end gap-2"},Me=W({__name:"edit-item",emits:["search"],setup(Z,{expose:i,emit:c}){const{t:d}=G(),N=L(),R=c,{getServiceAccount:P,updateServiceAccount:h}=q(),s=y(!1),a=H({accesskey:"",policy:"",expiry:null,name:"",description:"",status:"on"}),_=y(!1),C=y(""),A=F({get:()=>a.status==="on",set:K=>{a.status=K?"on":"off"}}),j=F(()=>Y().toISOString());async function D(K){C.value=K.accessKey;try{const n=await P(K.accessKey);a.accesskey=K.accessKey;const T=typeof n.policy=="string"?n.policy:JSON.stringify(n.policy??{});a.policy=T,a.expiry=n.expiration&&n.expiration!=="9999-01-01T00:00:00Z"?Y(n.expiration).toISOString():null,a.name=n.name??"",a.description=n.description??"",a.status=n.accountStatus??"on",s.value=!0}catch(n){console.error(n),N.error(d("Failed to get data"))}}i({openDialog:D});function V(){s.value=!1,_.value=!1}async function M(){if(C.value){_.value=!0;try{await h(C.value,{newPolicy:a.policy||"{}",newStatus:a.status,newName:a.name,newDescription:a.description,newExpiration:a.expiry?Y(a.expiry).toISOString():"9999-01-01T00:00:00Z"}),N.success(d("Updated successfully")),V(),R("search")}catch(K){console.error(K),N.error(d("Update failed"))}finally{_.value=!1}}}return(K,n)=>{const T=X;return k(),S(se,{modelValue:s.value,"onUpdate:modelValue":n[7]||(n[7]=r=>s.value=r),title:e(d)("Edit Key"),size:"lg","close-on-backdrop":!1},{footer:l(()=>[w("div",Ne,[t(e($),{variant:"outline",onClick:n[6]||(n[6]=r=>V())},{default:l(()=>[f(u(e(d)("Cancel")),1)]),_:1}),t(e($),{variant:"default",disabled:_.value,onClick:M},{default:l(()=>[_.value?(k(),S(e(ee),{key:0,class:"size-4"})):I("",!0),w("span",null,u(e(d)("Submit")),1)]),_:1},8,["disabled"])])]),default:l(()=>[w("div",$e,[t(e(x),null,{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(d)("Access Key")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(z),{modelValue:a.accesskey,"onUpdate:modelValue":n[0]||(n[0]=r=>a.accesskey=r),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(d)("Policy")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(T,{modelValue:a.policy,"onUpdate:modelValue":n[1]||(n[1]=r=>a.policy=r)},null,8,["modelValue"])]),_:1})]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(d)("Expiry")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(te,{modelValue:a.expiry,"onUpdate:modelValue":n[2]||(n[2]=r=>a.expiry=r),min:j.value},null,8,["modelValue","min"])]),_:1})]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(d)("Name")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(z),{modelValue:a.name,"onUpdate:modelValue":n[3]||(n[3]=r=>a.name=r)},null,8,["modelValue"])]),_:1})]),_:1}),t(e(x),null,{default:l(()=>[t(e(v),null,{default:l(()=>[f(u(e(d)("Description")),1)]),_:1}),t(e(g),null,{default:l(()=>[t(e(ae),{modelValue:a.description,"onUpdate:modelValue":n[4]||(n[4]=r=>a.description=r),rows:2},null,8,["modelValue"])]),_:1})]),_:1}),t(e(x),{orientation:"responsive"},{default:l(()=>[t(e(v),{class:"text-sm font-medium"},{default:l(()=>[f(u(e(d)("Status")),1)]),_:1}),t(e(g),{class:"flex justify-end"},{default:l(()=>[t(e(le),{modelValue:A.value,"onUpdate:modelValue":n[5]||(n[5]=r=>A.value=r)},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["modelValue","title"])}}}),Te=Object.assign(Me,{__name:"AccessKeysEditItem"}),Re={class:"text-2xl font-bold"},Oe={class:"space-y-3"},Dt=W({__name:"index",setup(Z){const{t:i}=G(),c=ve(),d=L(),{listUserServiceAccounts:N,deleteServiceAccount:R}=q(),P=y([]),h=y(!1),s=y(""),a=o=>{T.value?.openDialog(o)},_=o=>{c.error({title:i("Warning"),content:i("Are you sure you want to delete this key?"),positiveText:i("Confirm"),negativeText:i("Cancel"),onPositiveClick:()=>ne(o.accessKey)})},C=[{accessorKey:"accessKey",header:()=>i("Access Key"),cell:({row:o})=>b("span",{class:"font-mono text-sm"},o.original.accessKey),filterFn:"includesString"},{accessorKey:"expiration",header:()=>i("Expiration"),cell:({row:o})=>b("span",o.original.expiration&&o.original.expiration!=="9999-01-01T00:00:00Z"?Y(o.original.expiration).format("YYYY-MM-DD HH:mm"):"-")},{accessorKey:"accountStatus",header:()=>i("Status"),cell:({row:o})=>b(ye,{variant:o.original.accountStatus==="on"?"secondary":"destructive"},()=>o.original.accountStatus==="on"?i("Available"):i("Disabled"))},{accessorKey:"name",header:()=>i("Name"),cell:({row:o})=>b("span",o.original.name||"-")},{accessorKey:"description",header:()=>i("Description"),cell:({row:o})=>b("span",o.original.description||"-")},{id:"actions",header:()=>i("Actions"),enableSorting:!1,enableHiding:!1,meta:{width:200},cell:({row:o})=>b("div",{class:"flex justify-center gap-2"},[b($,{variant:"outline",size:"sm",onClick:()=>a(o.original)},()=>[b(B,{name:"ri:edit-2-line",class:"size-4"}),b("span",i("Edit"))]),b($,{variant:"outline",size:"sm",onClick:()=>_(o.original)},()=>[b(B,{name:"ri:delete-bin-5-line",class:"size-4"}),b("span",i("Delete"))])])}],{table:A,selectedRowIds:j}=Ae({data:P,columns:C,getRowId:o=>o.accessKey,enableRowSelection:!0});ge(s,o=>{A.getColumn("accessKey")?.setFilterValue(o||void 0)});const D=F(()=>j.value),V=async()=>{h.value=!0;try{const o=await N({});P.value=o.accounts||[]}catch(o){console.error(o),d.error(i("Get Data Failed"))}finally{h.value=!1}};xe(V);const M=()=>{V()},K=y(),n=y(!1),T=y(),r=y(),m=y(!1),O=y();function p(){n.value=!0}function oe(o){O.value?.openDialog(o)}async function ne(o){try{await R(o),d.success(i("Delete Success")),await V()}catch(U){console.error(U),d.error(i("Delete Failed"))}}function ie(){if(!D.value.length){d.error(i("Please select at least one item"));return}c.error({title:i("Warning"),content:i("Are you sure you want to delete all selected keys?"),positiveText:i("Confirm"),negativeText:i("Cancel"),onPositiveClick:async()=>{try{await Promise.all(D.value.map(o=>R(o))),d.success(i("Delete Success")),A.resetRowSelection(),await V()}catch(o){console.error(o),d.error(i("Delete Failed"))}}})}return(o,U)=>{const re=Ke,ce=be,ue=Ie,de=Te,me=Se,pe=Ve,fe=ke;return k(),S(fe,null,{default:l(()=>[t(ce,null,{actions:l(()=>[t(re,{modelValue:s.value,"onUpdate:modelValue":U[0]||(U[0]=E=>s.value=E),placeholder:e(i)("Search Access Key"),clearable:"",class:"max-w-xs"},null,8,["modelValue","placeholder"]),D.value.length?(k(),S(e($),{key:0,variant:"outline",disabled:!D.value.length,onClick:ie},{default:l(()=>[t(e(B),{name:"ri:delete-bin-5-line",class:"size-4"}),w("span",null,u(e(i)("Delete Selected")),1)]),_:1},8,["disabled"])):I("",!0),t(e($),{variant:"outline",onClick:p},{default:l(()=>[t(e(B),{name:"ri:add-line",class:"size-4"}),w("span",null,u(e(i)("Add Access Key")),1)]),_:1})]),default:l(()=>[w("h1",Re,u(e(i)("Access Keys")),1)]),_:1}),w("div",Oe,[t(De,{table:e(A),"is-loading":h.value,"empty-title":e(i)("No Access Keys"),"empty-description":e(i)("Create a new access key to get started."),class:"overflow-hidden","table-class":"min-w-full"},null,8,["table","is-loading","empty-title","empty-description"]),t(we,{table:e(A),class:"px-2 py-3"},null,8,["table"])]),t(ue,{ref_key:"newItemRef",ref:K,visible:n.value,"onUpdate:visible":U[1]||(U[1]=E=>n.value=E),onSearch:M,onNotice:oe},null,8,["visible"]),t(de,{ref_key:"editItemRef",ref:T,onSearch:M},null,512),t(me,{ref_key:"changePasswordModalRef",ref:r,visible:m.value,"onUpdate:visible":U[2]||(U[2]=E=>m.value=E)},null,8,["visible"]),t(pe,{ref_key:"noticeRef",ref:O,onSearch:M},null,512)]),_:1})}}});export{Dt as default};
